Theodorus.View=Backbone.View.extend({setController:function(e){this.controller=e},setElement:function(e){this.jElement="string"==typeof e||e instanceof HTMLElement?$(e):e},setAsPopUp:function(e){this.isPopup=e},transform:function(e,t){var n=$,i=t;!this.isPopup&&this.jElement&&(0===this.jElement.size()&&(this.jElement=$(this.jElement.selector)),this.jElement.size()>0?n=this.jElement:console.log("failed to find element ("+this.jElement.selector+") for \n"+e)),this.isPopup&&(i=function(e){$("#popup_placeholder").append(e),t(e)}),n.transform({async:!1,xslCache:!0,xmlstr:"<xml>"+e+"</xml>",xsl:"/ui/xslt/default.xsl",success:i,error:function(t){alert("error transforming :"+t+"\n"+e)}})},getFormFields:function(e){var t=e.elements,n={};for(var i in t){var s=t[i];s.name&&(n[s.name]="checkbox"==s.type?s.checked:s.value)}return n}}),Theodorus.namespace("feed").AddTopicView=Theodorus.View.extend({initialize:function(){this.setElement("#add_topic"),_.bindAll(this,"onsubmit","onSlugKeyUp","cancel","setup")},render:function(e){var t=this,n=function(){t.setup(),e&&e(this)};return-1!=this.controller.me().get("permissions").indexOf("suggest")?this.transform("<addTopic prefix='"+this.controller.URLPrefix()+"'/>",n):this.jElement.html(""),this},setup:function(e){return document.getElementById("form_add_topic").onsubmit=this.onsubmit,document.getElementById("slug").onkeyup=this.onSlugKeyUp,document.getElementById("button_cancel").onclick=this.cancel,e&&e(),this},onSlugKeyUp:function(e){var t=this;delay(function(){e.target.value.length>0?($("#topic_complete_slug").addClass("loading"),t.controller.isSlugAvailable(e.target.value,function(e){$("#topic_slug_result").removeClass("loading"),transform($("#topic_slug_result"),"<slugTest result='"+e.result+"'/>")})):$("#topic_slug_result").html("")},1e3)},onsubmit:function(e){return transform($("#messages"),"<message type='info' message='sending-data' />"),this.controller.submit(e.target.action,getFormFields(e.target),function(e){e.error?transform($("#messages"),"<message type='error' message='"+e.error+"' />"):$("#messages").html("")}),!1},cancel:function(){return document.getElementById("form_add_topic").remove(),!1}}),Theodorus.namespace("feed").FeedView=Theodorus.View.extend({initialize:function(){this.setElement("#main"),_.bindAll(this,"openAddTopicWindow")},render:function(e){var t=this,n=this.controller.me(),i='<page type="feed">'+this.controller.me().xml()+(n.can("suggest")?"<addTopic/>":"")+"</page>";return this.transform(i,function(){t.setup(),e&&e(this)}),this},setup:function(e){$("#link_suggest_topic").click(this.openAddTopicWindow),e&&e(this)},openAddTopicWindow:function(){return this.controller.openAddTopicWindow(),!1}}),Theodorus.namespace("feed").TopicListView=Theodorus.View.extend({initialize:function(){this.setElement("#topics")},render:function(e){var t=this;return this.transform(this.controller.collection.xml(),function(){t.setup(),e&&e()}),this},setup:function(e){e&&e()}}),Theodorus.namespace("user").AccountView=Theodorus.View.extend({initialize:function(){this.setElement("#account"),_.bindAll(this,"openAuthenticationWindow")},render:function(e){var t=this;return this.transform(this.controller.user(),function(){t.setup(),e&&e()}),this},setup:function(e){var t=this;$("#btn_signup").click(this.openAuthenticationWindow),$("#btn_signin").click(this.openAuthenticationWindow),$("#btn_signout").click(function(){return!t.controller.signout()}),e&&e()},openAuthenticationWindow:function(e){return this.controller.openAuthenticationWindow("signin"==e.target.id.replace(/btn_/,"")),!1}}),Theodorus.namespace("user").SigninView=Theodorus.View.extend({initialize:function(){this.setElement("#main"),_.bindAll(this,"render","setup","onsubmit","cancel")},render:function(e){var t=this;return this.transform("<signin />",function(){return t.setup(),e?e(t):void 0}),this},setup:function(e){document.getElementById("form_signin").onsubmit=this.onsubmit,document.getElementById("button-cancel").onclick=this.cancel,e&&e(this)},onsubmit:function(e){return transform($("#messages"),"<message type='info' message='authenticating' />"),this.controller.submit(e.target.action,getFormFields(e.target),function(){}),!1},cancel:function(){return document.getElementById("form_signin").remove(),!1}}),Theodorus.namespace("user").SignupView=Theodorus.View.extend({initialize:function(){this.setElement("#main"),_.bindAll(this,"onsubmit","cancel")},render:function(e){return this.transform("<signup />",function(){this.setup(e)}),this},setup:function(e){document.getElementById("form_signup").onsubmit=this.onsubmit.bind(this),document.getElementById("button-cancel").onclick=this.cancel,e&&e()},onsubmit:function(e){return transform($("#messages"),"<message type='info' message='sending-data' />"),this.controller.submit(e.target.action,getFormFields(e.target),function(e){e.error&&transform($("#messages"),"<message type='error' message='"+e.error+"' />")}),!1},cancel:function(){return document.getElementById("form_signup").remove(),!1}});