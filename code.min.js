app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t,s,n,a){n[i]=a,t&&s(n)}this.api=this.api||{backend:server,cache:{},cacheExpiration:18e4},this.api.saveToCache=function(i,t,s){this.api.cache[i]={modified:(new Date).getTime(),response:s},t(s)}.bind(this),this.api.ajax=function(i,t,s,n){var a=i+"-"+t;if(this.log("api "+a,this.logType.debug),"get"===i){var o=this.api.cache;n=s,"get"===i&&o[a]&&o[a].modified>(new Date).getTime()-this.api.cacheExpiration?n(o[a].response):O.AJAX.get(this.api.backend+t,this.api.ifNotError.bind(this,this.api.saveToCache.bind(this,a,n)))}else this.api.clearCache(),"post"===i||"put"===i?O.AJAX[i](this.api.backend+t,s,this.api.ifNotError.bind(this,n)):(n=s,O.AJAX[i](this.api.backend+t,this.api.ifNotError.bind(this,this.api.saveToCache.bind(this,a,n))))}.bind(this),this.api.clearCache=function(){this.api.cache={}}.bind(this),this.api.ifNotError=function(i,t){t instanceof Error&&t.message instanceof XMLHttpRequestProgressEvent&0===t.status?O.EVT.dispatch("connection-error",t.message):this.ifNotError(i,t)}.bind(this),this.api.async=function(t,s){for(var n=t.slice().reverse(),a={};n.length;){var o=n.pop(),p=o.name.split(" ").pop();o(i.bind(this,p,0===n.length,s,a))}}.bind(this),this.api.ping=function(i){O.AJAX.get(this.api.backend+"ping",this.api.ifNotError.bind(this,i))}.bind(this);var t=function(i,t,s,n){this.api.ajax("post",i,{email:t,password:s},n)};return this.api.signIn=t.bind(this,"signin"),this.api.signUp=t.bind(this,"signup"),this.api.addCommunity=function(i,t){this.api.ajax("post","community/",i,t)}.bind(this),this.api.getCommunityList=function(i){this.api.ajax("get","community/",i)}.bind(this),this.api.getMyCommunities=function(i){this.api.ajax("get","membership/",i)}.bind(this),this.api.getCommunity=function(i,t){this.api.ajax("get","community/"+i+"/",t)}.bind(this),this.api.getCommunityTopics=function(i,t){this.api.ajax("get","community/"+i+"/topics/",t)}.bind(this),this.api.joinCommunity=function(i,t,s){this.api.ajax("post","community/"+i+"/members/",t,s)}.bind(this),this.api.quitCommunity=function(i,t){this.api.ajax("post","community/"+i+"/quit/",{},t)}.bind(this),this.api.archive=function(i,t,s){this.api.ajax("delete",i+"/"+t,s)}.bind(this),this.api.getCommunityTopics=function(i,t){this.api.ajax("get","community/"+i+"/topics/",t)}.bind(this),this.api.addTopic=function(i,t){this.api.ajax("post","topic/",i,t)}.bind(this),this.api.getTopicOpinions=function(i,t){this.api.ajax("get","topic/"+i+"/opinions/",t)}.bind(this),this.api.setOpinion=function(i,t){i.id?this.api.ajax("post","opinion/"+i.id,i,t):i.topicId?this.api.ajax("post","topic/"+i.topicId+"/opinion/",i,t):t(new Error("missing-details"))}.bind(this),this.api.getPostComments=function(i,t,s){var n=void 0===t?"opinion":"comment";"opinion"===n&&(t=i),this.api.ajax("get",n+"/"+t+"/comments/",s)}.bind(this),this.api.setComment=function(i,t){i.id?this.api.ajax("post","comment/"+i.id,i,t):this.api.ajax("post","comment/",i,t)}.bind(this),this.api.feedback=function(i,t){this.api.ajax("post","feedback/",i,t)}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function e(){var e=location.href;return html2canvas(document.body,{onrendered:function(i){window.setTimeout(t.bind(this,i.toDataURL(),e),1)}}),!0}function t(e,t){O.ELM.url.value=t,O.ELM.image.value=e,O.ELM.screenshotSample.src=e,O.ELM.screenshotRow.removeAttribute("data-hidden")}function i(e){try{var t=this.getFormFields(e.detail.target);t.feedbackIncludesScreenshot||delete t.image,this.notify({notifySuccessFeedbackSent:{}})}catch(i){this.log(i,"debug")}return e.detail.preventDefault(),!1}return this.registry=this.registry||{},O.EVT.subscribe("capture-state",e.bind(this)).subscribe("send-feedback",i.bind(this)),this.registry.reportBug=function(e,t){e.onclick=O.EVT.getDispatcher("capture-state"),t()}.bind(this),this.registry.frmSendFeedback=function(e,t){e.onsubmit=O.EVT.getDispatcher("send-feedback"),t()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){for(var t="",m=0,n={},e=i.length;e--;){var s=i[e].membershipName,o=n[s];o=void 0===n[s]?1:o+1,n[s]=o,o>=m&&(t=s,m=o)}O.ELM.founderName.value=t}function t(i,t){this.state.communityJSON=t.getCommunity,this.state.communityTopics=t.getCommunityTopics;var m={communityId:t.getCommunity.id,communityName:t.getCommunity.name,isMember:void 0!==t.getCommunity.membership&&"active"===t.getCommunity.membership.status,topics:t.getCommunityTopics};m.isMember&&(m.memberName=t.getCommunity.membership.name?t.getCommunity.membership.name:""),this.render(O.ELM.pageContainer,{communityPage:m}),i()}function m(i){var t={name:O.ELM.communityName.value};if(0===t.name.length)alert("name cannot be empty");else{var m=O.ELM.founderName.value;m.length>0&&(t.founderName=m),this.api.addCommunity(t,n.bind(this))}return!1}function n(i){i instanceof Error||!i?(alert("failed to add community"),console.log(i)):location.href="#community:"+i.id}function e(i,t){this.render(i,{communityList:{communities:{community:t}}})}return this.registry=this.registry||{},this.registry.frmAddCommunity=function(t,n){t.onsubmit=O.EVT.subscribe("submit-add-community",m.bind(this)).getDispatcher("submit-add-community"),this.api.getMyCommunities(i.bind(this)),n()}.bind(this),this.registry.communityPage=function(i,m){var n=this.state.community;void 0!==n&&n.length>0?this.api.async([this.api.getCommunity.bind(this,n),this.api.getCommunityTopics.bind(this,n)],t.bind(this,m)):this.updateURL("communities","")}.bind(this),this.registry.frmAddCommunity=function(i,t){i.onsubmit=O.EVT.subscribe("submit-add-community",m.bind(this)).getDispatcher("submit-add-community"),t()}.bind(this),this.registry.myCommunityList=function(i,t){this.api.getCommunityList(e.bind(this,i)),t()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function n(){void 0!==O.ELM.connectionError&&O.DOM.remove(O.ELM.connectionError)}var i=0;this.registry=this.registry||{},this.state=this.state||{},this.registry.ping=function(i,t){i.onclick=O.EVT.subscribe("ping",this.api.ping.bind(this,n)).getDispatcher("ping"),t()}.bind(this);var t=function(){var n=O.COOKIE("authToken"),i=n.length>0;i&&O.AJAX.setDefaults({credentials:n}),this.render(O.ELM.appContainer,{application:{showUserDetailsInHeader:i}}),this.register(O.ELM.appContainer)}.bind(this);return this.onConnectionError=function(){void 0===O.ELM.connectionError&&this.notify({notifyErrorConnection:{}})}.bind(this),this.onComponentLoaded=function(){--i||(window.onhashchange=O.EVT.subscribe("window.onhashchange",this.onPageChanged).getDispatcher("window.onhashchange"),O.ELM.refresh(),t(),this.api.ping(n))}.bind(this),this.init=function(){i=3,O.EVT.subscribe("window.onload",this.onComponentLoaded).subscribe("TPL.templatesLoaded",this.onComponentLoaded).subscribe("TPL.languageLoaded",this.onComponentLoaded).subscribe("connection-error",this.onConnectionError),O.TPL.load("templates.html"),O.TPL.setLocale("en-us"),O.TPL.loadLanguage("i18n/en-us.json")}.bind(this),this.init(),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(){return this.log("not yet implemented",this.logType.error),!1}function i(t){var i=t.detail.target.closest("[data-id][data-type]"),e=i.getAttribute("data-type"),n=i.getAttribute("data-id"),s=i.parentNode;this.api.archive(e,n,this.simplyReturn),this.updateCount(s.closest("[data-id][data-type]"),i.getAttribute("data-type"),-1),"opinion"!==e?O.DOM.remove(s):O.ELM.opinionContent.value=""}return this.registry=this.registry||{},this.state=this.state||{},this.registry.appContainer=function(t,i){this.renderPage(),i()}.bind(this),this.onCancelButtonClicked=function(){history.back()}.bind(this),this.registry.btnCancel=function(t,i){t.onclick=this.onCancelButtonClicked,i()}.bind(this),O.EVT.subscribe("submit-page-not-found",t.bind(this)),this.registry.notFoundPage=function(t,i){O.ELM.frmPageNotFound.onsubmit=O.EVT.getDispatcher("submit-page-not-found"),O.ELM.pageNotFoundURL.value=window.location.hash}.bind(this),this.isAuthenticated=function(){var t=O.COOKIE("authToken");return t.length>0}.bind(this),this.onPageChanged=function(t){var i=t.detail.newURL;this.renderPage(i.substr(i.indexOf("#")),"")}.bind(this),this.updateURL=function(t,i){history.pushState({},i,location.href.split("#")[0]+"#"+t),this.renderPage()}.bind(this),this.getPageTitleFromHash=function(t){if(!t.length)return"";for(var i=t[0].key,e=1;e<t.length;e++){var n=t[e].key;i+=" "+n.substr(0,1).toUpperCase()+n.substr(1)}return i}.bind(this),this.setAppTitle=function(t){var i=document.title.split(":")[0];document.title=i+(t.length>0?": "+t.substr(0,1).toUpperCase()+t.substr(1):"")}.bind(this),this.renderPage=function(){var t={},i=this.extractArgumentsFromLocationHash(),e=this.getPageTitleFromHash(i),n=(e.length?e.replace(/\s/g,""):this.isAuthenticated()?"home":"welcome")+"Page";O.ELM.appContainer.setAttribute("data-section",i.length>0?i[0].key:"home"),-1===O.TPL.list().indexOf(n)&&(n="notFoundPage"),t[n]={},this.state=this.getMappedArguments(),this.setAppTitle(e),this.log("renderPage "+n,this.logType.debug),this.render(O.ELM.pageContainer,t),this.register(n)}.bind(this),O.EVT.subscribe("archive",i.bind(this)),this.registry.archive=function(t,i){t.onclick=O.EVT.getDispatcher("archive"),i()}.bind(this),this.updateCount=function(t,i,e){if(t){var n=t.querySelector('[data-role="'+i+'-count"]');n&&(n.innerHTML=+n.innerHTML+e)}}.bind(this),this.onCloseNotificationClicked=function(t){return O.DOM.remove(t.target.closest(".notification")),!1}.bind(this),this.registry.closeNotification=function(t,i){t.onclick=this.onCloseNotificationClicked,i()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return!0}function e(t){return!0}function i(t){return void 0===t||e(t)}var n='((([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))';this.models=this.models||{};var a=this.models;return a.user={status:{"enum":{active:"active",suspended:"suspended",archived:"archived"},validate:function(t){return!0}},created:{},modified:{},lastLogin:{},email:{validate:function(t){return t.match(n)?!0:void 0}},password:{validate:function(t){return t&&t.length>0}},birthDate:{},isFemale:{}},a.community={},a.membership={},a.topic={content:{validate:function(t,e){return!0}}},a.opinion={id:{validate:i},topicId:{validate:e},content:{validate:function(t,e){return!0}}},a.comment={id:{validate:i},opinionId:{validate:e},parentId:{validate:i},content:{validate:function(t,e){return!0}}},a.feedback={id:{validate:i},image:{validate:t},content:{validate:function(t){return t>0}}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var n=O.ELM.signInEmail.value,s=O.ELM.signInPassword.value;return this.api.signIn(n,s,t.bind(this,!0)),!1}function t(i,t){t instanceof Error?alert("failed to sign in"):(O.COOKIE("authToken",t,i?30:1),this.api.clearCache(),this.goToStateRedirect())}return this.registry=this.registry||{},this.registry.frmSignIn=function(t,n){t.onsubmit=O.EVT.subscribe("submit-sign-in",i.bind(this)).getDispatcher("submit-sign-in"),n()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return O.COOKIE("authToken",""),this.api.clearCache(),this.goToStateRedirect(),!1}return this.registry=this.registry||{},this.registry.btnSignOut=function(i,e){i.onclick=O.EVT.subscribe("sign-out",t.bind(this)).getDispatcher("sign-out"),e()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var t=O.ELM.signUpEmail.value,e=O.ELM.signUpPassword.value,r=O.ELM.signUpRetypePassword.value,a=this.models.user;return a.email.validate(t)?a.password.validate(e)?e===r?this.api.signUp(t,e,s.bind(this)):this.log("retype password",this.logType.error):this.log("illegal password",this.logType.error):this.log("illegal email",this.logType.error),!1}function s(i){i instanceof Error?alert("failed to sign up"):(O.COOKIE("authToken",i,1),this.api.clearCache(),this.goToStateRedirect())}return this.registry=this.registry||{},this.registry.frmSignUp=function(s,t){s.onsubmit=O.EVT.subscribe("submit-sign-up",i.bind(this)).getDispatcher("submit-sign-up"),t()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var s=this.state.community;this.api.getCommunityTopics(s,t.bind(this,i))}function t(i,t){for(var s=this.state.communityJSON.membership?this.state.communityJSON.membership.id:!1,o=t.length;o--;){var n=t[o];n.time=moment(n.modified).format("MMM Do YY, h:mma"),n.relativeTime=moment(n.modified).fromNow(),n.isArchivable=s===n.author.id&&0===n.opinions&&0===n.endorse}this.render(i,{topicList:{topics:{topic:t}}})}function s(){var i=O.ELM.topicContent.value;if(this.models.topic.content.validate(i,this.state.communityJSON)){var t={communityId:this.state.community,content:i,status:"published"};this.api.addTopic(t,o.bind(this))}return!1}function o(){i.call(this,O.ELM.communityTopics)}return this.registry=this.registry||{},this.registry.communityTopicList=function(t,s){i.call(this,t),s()}.bind(this),this.registry.frmAddTopic=function(i,t){i.onsubmit=O.EVT.subscribe("submit-add-topic",s.bind(this)).getDispatcher("submit-add-topic"),t()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";this.ifNotError=function(e,t){t instanceof Error?alert(t):e(t)}.bind(this),this.simplyReturn=function(e){return e}.bind(this),this.isProduction=function(){var e=location.href;return-1===e.indexOf("localhost")&&-1===e.indexOf("127.0.0.1")}(),this.logType={debug:"debug",system:"system",community:"community",message:"message",score:"score",error:"error"},this.log=function(e,t,i){return void 0===t&&(t=this.logType.system),t===this.logType.debug&&this.isProduction||(void 0===i?console.log(t+": "+e):console.log(t+": "+e,i)),e}.bind(this),this.notify=function(e){var t=O.ELM.notifications;O.DOM.append(t,O.TPL.render(e)),O.ELM.refresh(),this.register(t.childNodes[t.childNodes.length-1])}.bind(this),this.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}.bind(this),this.goToStateRedirect=function(){location.href=location.href.split("#")[0]+(this.state.redirect?this.state.redirect:"")}.bind(this),this.getPathFromURL=function(){return location.href.replace(new RegExp("(https?:\\/\\/)|("+location.host+"\\/)","g"),"").split("#")[0].split("?")[0]}.bind(this),this.extractArgumentsFromLocationHash=function(){for(var e,t=/\+/g,i=/([^\/:]+):?([^\/]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},r=window.location.hash.substring(1),s=[];e=i.exec(r);){var o={key:n(e[1]),value:n(e[2])};s.push(o)}return s}.bind(this);var e=function(){for(var e,t=/\+/g,i=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},r=window.location.search.substring(1),s={};e=i.exec(r);)s[n(e[1])]=n(e[2]);return s},t=function(e,t){return decodeURIComponent(t.replace(e," "))},i=function(){for(var e,i=/\+/g,n=/([^\/:]+):?([^\/]*)/g,r=t.bind(this,i),s=window.location.hash.substring(1),o={};e=n.exec(s);)o[r(e[1])]=r(e[2]);return o};return this.getMappedArguments=function(){return this.extend(e(),i())}.bind(this),this.getFormFields=function(e){var t=e.elements,i={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.name&&(i[r.name]="checkbox"==r.type?r.checked:r.value)}return i}.bind(this),this.render=function(e,t){try{e.innerHTML=O.TPL.render(t),O.ELM.refresh()}catch(i){this.log(i,this.logType.debug)}}.bind(this),this.onElementRegistered=function(e){void 0!==e&&e.length&&this.registerS(O.ELM.per("#"+e+" [data-register]:not(.js-registered)"))}.bind(this),this.registerS=function(e){for(var t=e.length;t--;){var i=e[t];"none"!==i.style.display&&this.register(i)}}.bind(this),this.register=function(e){var t,i;if(void 0!==e){"string"==typeof e?(i=e,e=O.ELM.pageContainer):i=e.getAttribute("data-register"),t=e.id,0===t.length&&(e.setAttribute("id",i?i:"elm"+parseInt(1e4*Math.random())),t=e.id),(void 0===i||null===i||0===i.length)&&(i=t),O.CSS.remove(e,"register").add(e,"registering");var n=this.registry[i];this.log("register %c"+(n?"✓ ":"✗ ")+i,this.logType.debug,n?"color: green":"color: red"),n?n(e,this.onElementRegistered.bind(this,t)):this.onElementRegistered(t),O.CSS.remove(e,"registering").add(e,"registered")}}.bind(this),this.onWindowResize=function(){this.registerS(O.ELM.per(".js-register"))}.bind(this),window.onresize=O.EVT.subscribe("window.resize",this.onWindowResize).getDispatcher("window.resize"),this}.call(app);