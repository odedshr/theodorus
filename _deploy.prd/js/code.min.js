app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){switch(t.type){case"checkbox":return t.checked!==t.defaultChecked;case"select-one":return!t.options[t.selectedIndex].defaultSelected;default:return t.value!==t.defaultValue}}function i(t){switch(t.type){case"checkbox":return t.checked;case"select-one":return!t.options[t.selectedIndex].value;default:return t.value}}function e(t,i,e){if(void 0===i){if(void 0===e)return;throw this.log("no template for "+i,this.logType.debug),new Error("template-not-found")}try{if(this.templates[i]){var s={};s[i]=e,t.innerHTML=O.TPL.render(s),O.ELM.refresh()}else this.log("no template for "+i,this.logType.debug);this.registerChildren(t.querySelectorAll("[data-register]:not(.js-registered)"))}catch(n){this.log(n,this.logType.debug),this.log(t,this.logType.debug),this.log(i,this.logType.debug),this.log(e,this.logType.debug)}}this.registry=this.templates||{},this.templates=this.templates||{},this.ifNotError=function(t,i){i instanceof Error?alert(i):t(i)}.bind(this),this.simplyReturn=function(t){return t}.bind(this),this.isProduction=function(){var t=location.href;return-1===t.indexOf("localhost")&&-1===t.indexOf("127.0.0.1")}(),this.logType={debug:"debug",system:"system",community:"community",message:"message",score:"score",error:"error"},this.log=function(t,i,e){var s=this.logType;switch(void 0===i&&(i=s.system),i){case s.debug:console.debug(t);break;case s.system:this.notify({notifySystem:{message:t,status:"info"}});break;case s.community:this.notify({notifyCommunity:{message:t,status:"info"}});break;case s.message:this.notify({notifyMessage:{message:t,status:"info"}});break;case s.score:this.notify({notifyScore:{message:t,status:"info"}});break;case s.error:t instanceof Error&&(console.debug(t),t=t.message),this.notify({notifySystem:{message:t,status:"error"}});break;default:this.isProduction||(void 0===e?console.log(i+": "+t):console.log(i+": "+t,e))}return t}.bind(this),this.clone=function(t){return JSON.parse(JSON.stringify(t))},this.confirm=function(t,i){i(window.confirm(t))}.bind(this),this.extend=function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t}.bind(this),this.goToStateRedirect=function(){var t=this.state.redirect?this.state.redirect:"";history.pushState({},t,location.href.split("#")[0]+"#"+t),this.register(O.ELM.appContainer)}.bind(this),this.getPathFromURL=function(){return location.href.replace(new RegExp("(https?:\\/\\/)|("+location.host+"\\/)","g"),"").split("#")[0].split("?")[0]}.bind(this),this.extractArgumentsFromLocationHash=function(){for(var t=/\+/g,i=/([^\/:]+):?([^\/]*)/g,e=function(i){return decodeURIComponent(i.replace(t," "))},s=window.location.hash.substring(1),n=[],r=i.exec(s);r;){var a={key:e(r[1]),value:e(r[2])};n.push(a),r=i.exec(s)}return n}.bind(this);var s=function(){for(var t=/\+/g,i=/([^&=]+)=?([^&]*)/g,e=function(i){return decodeURIComponent(i.replace(t," "))},s=window.location.search.substring(1),n={},r=i.exec(s);r;)n[e(r[1])]=e(r[2]),r=i.exec(s);return n},n=function(t,i){return decodeURIComponent(i.replace(t," "))},r=function(){for(var t=/\+/g,i=/([^\/:]+):?([^\/]*)/g,e=n.bind(this,t),s=window.location.hash.substring(1),r={},a=i.exec(s);a;)r[e(a[1])]=e(a[2]),a=i.exec(s);return r};return this.getMappedArguments=function(){return this.extend(s(),r())}.bind(this),this.getFormFields=function(e,s){var n=e.elements,r={},a=[];for(var o in n)if(n.hasOwnProperty(o)){var h=n[o];(h.name&&h.name.length>0&&!s||t(h))&&("function"==typeof h.checkValidation&&h.checkValidation()===!1?a[a.length]=element:h.name&&h.name.length>0&&(r[h.name]=i(h)))}if(a.length>0){var c=new Error("validation-erros");throw c.fields=a,c}return r}.bind(this),this.getDirtyFormFields=function(t){return this.getFormFields(t,!0)}.bind(this),this.setValidationMessage=function(t,i){t.setCustomValidity(i);var e=O.ELM[t.id+"Errors"];e&&(e.innerHTML=i)}.bind(this),this.registerChildren=function(t){for(var i=t.length;i--;){var e=t[i];"none"!==e.style.display&&this.register(e)}}.bind(this),this.register=function(t){var i=t.getAttribute("data-register");void 0===i&&(i=t.getAttribute("id")),O.CSS.remove(t,"register").add(t,"registering");var s=this.registry[i];if(void 0!==s&&void 0!==s.attributes){var n=s.attributes;for(var r in n)t[r]=n[r]}if(void 0===s){if(void 0===this.templates[i])throw new Error("cannot register template "+i);e.call(this,t,i,{})}else void 0!==s.preprocess&&s.preprocess.call(this,t,e.bind(this,t,i));O.CSS.remove(t,"registering").add(t,"registered")}.bind(this),this.onWindowResize=function(){this.registerChildren(O.ELM.per(".js-register"))}.bind(this),window.onresize=O.EVT.subscribe("window.resize",this.onWindowResize).getDispatcher("window.resize"),this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(){return this.state.redirect=location.href,!0}function i(){var t=location.href,i=t.indexOf("/#");return-1===i?(t.substr(t.length-1)&&(t=t.substr(0,t.length-1)),t):t.substr(0,i)}function e(t){var e=this.getFormFields(t.target),n=e.email,r=this.models.user;if(r.email.validate(n)){var a=(this.state.redirect?this.state.redirect:location.href).replace("#join",""),o=O.TPL.translate("mailSubject.joinTheConversation"),h=O.TPL.render({joinMail:{baseURL:i(),redirect:encodeURIComponent(a),expire:moment().add(1,"hours").format("k:mm (MMM Do YYYY)")}});this.api.postConnectionToken(n,o,h,s.bind(this))}else this.setValidationMessage(O.ELM.joinEmail,O.TPL.translate("error.pleaseUseProperEmail"));return!1}function s(t){t instanceof Error?(this.notify({notifySystem:{message:O.TPL.translate("notify.failedToMailToken"),status:"error"}}),this.log(t,this.logType.debug)):this.notify({notifySystem:{message:O.TPL.translate("notify.lookForYourJoinEmail"),status:"success"}})}function n(t,i){var e=this.state.connect;e&&e.length>0?this.api.getAuthToken(e,r.bind(this,i)):this.updateURL("")}function r(t,i){i instanceof Error?(this.log("error connecting",this.logType.error),this.log(i,this.logType.debug)):(O.COOKIE("authToken",i.token,90),this.api.clearCache(),location.href=this.state.redirect&&this.state.redirect.length>0?this.state.redirect:getDomain()),t()}function a(t){return O.COOKIE("authToken",""),this.state.email="",this.api.clearCache(),this.goToStateRedirect(),!1}return this.registry=this.registry||{},this.registry.getRedirectionURL={attributes:{onclick:t.bind(this)}},this.registry.frmJoin={attributes:{onsubmit:e.bind(this)}},this.registry.userConnectRedirectPage={preprocess:n.bind(this)},this.registry.userConnectPage={preprocess:n.bind(this)},this.registry.btnSignOut={attributes:{onclick:a.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){var s=this.state.community,n=this.registry.topicList.cached;n?e({topics:{topic:this.getFilteredItems.call(this,n,r)}}):this.api.getCommunityTopics(s,i.bind(this,e))}function i(t,i){if(i instanceof Error)return this.log("failed to load topic list",this.logType.error),this.log(i,this.logType.debug),t({topics:{topic:[]}});this.state.communityTopics=i;for(var e=i.topics||[],s=i.authors||{},n=!!this.state.communityJSON.membership,a=n?this.state.communityJSON.membership.id:!1,o=e.length;o--;){var h=e[o];h.author=s[h.authorId],h.time=moment(h.modified).format("MMM Do YY, h:mma"),h.relativeTime=moment(h.modified).fromNow(),h.isArchivable=a===h.author.id&&0===h.opinions&&0===h.endorse,h.isMember=n,h.viewpoint?(h.isEndorsed=!!h.viewpoint.endorse,h.isFollowed=!!h.viewpoint.follow,h.isRead=!!h.viewpoint.read):h.isEndorsed=h.isFollowed=h.isRead=!1}var c=Object.keys(s);for(o=c.length;o--;){var u=c[o],d=s[u];d.image=d.hasImage?this.api.getProfileImageURL(u):""}t({topics:{topic:this.getFilteredItems.call(this,e,r)}})}function e(t){var i=O.ELM.topicContent.value;if(this.models.topic.content.validate(i,this.state.communityJSON)){var e={topic:{communityId:this.state.community,content:i,status:"published"}};this.api.setTopic(e,s.bind(this))}return!1}function s(){delete this.state.communityTopics,this.register(O.ELM.communityTopics)}function n(t){r.content=t.target.value,this.registry.topicList.cached=this.state.communityTopics.topics,this.register(document.querySelector('[data-register="topicList"]')),delete this.registry.topicList.cached}this.registry=this.registry||{};var r={};return this.registry.topicList={preprocess:t.bind(this)},this.registry.frmAddTopic={attributes:{onsubmit:e.bind(this)}},this.registry.filterTopics={attributes:{onkeyup:n.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i,e){for(var s,n=this.api.getProfileImageURL,r=this.state.communityJSON,a=r.membership?r.membership.id:!1,o=e.opinions||[],h=e.authors||{},c=o.length;c--;){var u=o[c];u.author=h[u.authorId],u.isMember=!!a,u.isMine=a===u.author.id,u.time=moment(u.modified).format("MMM Do YY, h:mma"),u.relativeTime=moment(u.modified).fromNow(),u.isMine&&(s=u,u.isArchivable=0===u.comments&&0===u.endorse,o.splice(c,1))}var d=Object.keys(h);for(c=d.length;c--;){var m=d[c],p=h[m];p.image=p.hasImage?this.api.getProfileImageURL(m):""}a&&(void 0===s&&(s={author:{name:r.membership.name,image:n(a)},content:"",id:"",isMine:!0,relativeTime:""}),s.topicId=t,o.unshift(s)),i({opinions:{opinion:o}})}function i(t){var i=t.target,s=this.getFormFields(i);return 0===s.id.length&&delete s.id,this.api.setOpinion({opinion:s},e.bind(this,i,void 0===s.id)),!1}function e(t,i,e){if(e instanceof Error)this.log(e,this.logType.error);else{var s=t.closest('[data-id][data-type="topic"]'),n=s.getAttribute("data-id");i&&(this.updateCount(s,"opinion",1),this.removeArchiveButton("topic",n)),this.register(O.ELM["".concat("topic-",n,"-opinions")])}}return this.registry=this.registry||{},this.registry.opinionList={preprocess:function(i,e){var s=i.getAttribute("data-topic-id");this.api.getTopicOpinions(s,t.bind(this,s,e))}.bind(this)},this.registry.frmSetOpinion={attributes:{onsubmit:i.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return O.DOM.remove(t.target.closest(".notification")),!1}return this.registry=this.registry||{},this.notify=function(t){var i=O.ELM.notifications;void 0===i&&(i=O.ELM.appContainer),O.DOM.append(i,O.TPL.render(t)),O.ELM.refresh(),this.registerChildren(i.querySelectorAll("[data-register]:not(.js-registered)"))}.bind(this),this.registry.closeNotification={attributes:{onclick:t.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return!0}function i(t){return!0}function e(t){return void 0===t||i(t)}var s='((([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))';this.models=this.models||{};var n=this.models;return n.user={status:{"enum":{active:"active",suspended:"suspended",archived:"archived"},validate:function(t){return!0}},created:{},modified:{},lastLogin:{},email:{validate:function(t){return t.match(s)?!0:void 0}},password:{validate:function(t){return t&&t.length>0}},birthDate:{},isFemale:{}},n.community={},n.membership={},n.topic={content:{validate:function(t,i){return!0}}},n.opinion={id:{validate:e},topicId:{validate:i},content:{validate:function(t,i){return!0}}},n.comment={id:{validate:e},opinionId:{validate:i},parentId:{validate:e},content:{validate:function(t,i){return!0}}},n.feedback={id:{validate:e},image:{validate:t},content:{validate:function(t){return t>0}}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){document.title=O.TPL.translate("title.messages"),i()}return this.registry=this.registry||{},this.registry.messagesPage={preprocess:t},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){document.title=O.TPL.translate("title.settings"),i()}return this.registry=this.registry||{},this.registry.mePage={preprocess:t},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){this.state.user=i.user,t()}function i(){return history.back(),!1}function e(t,i,e){var n=e.target.closest("[data-register]"),r=n.closest(".js-item[data-type][data-id]");"true"===n.getAttribute("data-value")&&(t="un"+t),this.api.setAttribute(r.getAttribute("data-type"),r.getAttribute("data-id"),t,s.bind(this,n,i))}function s(t,i,e){t.setAttribute("data-value",e.value);var s=O.ELM["".concat(e.subjectType,"_",e.subjectId,"_",e.attribute,"_count")];void 0!==s&&(s.innerHTML=e.count),i&&i(t,e)}function n(t,i){document.title=O.TPL.translate("title.pageNotFound"),i({isAuthenticated:this.isAuthenticated()})}function r(){return this.log("not yet implemented",this.logType.error),!1}function a(t){var i=t.target.closest('[data-register="archive"]');if(i){var e=i.getAttribute("data-type"),s=i.getAttribute("data-id");this.api.archive(e,s,o.bind(this,e,s))}else this.log("failed to find archive button",this.logType.debug),this.log(i,this.logType.debug)}function o(t,i){var e;"topic"===t?e=O.ELM[t+"-"+i]:(e=O.ELM[t+"-"+i].parentNode.closest(".js-item[data-id][data-type]"),this.updateCount(e,t,-1)&&("opinion"!==t?O.DOM.remove(O.ELM[t+"-"+i]):(e.querySelector(".js-opinion-content").value="",e.querySelector(".attribute.time").innerHTML=""))),this.register(e.closest(".js-list"))}function h(t){var i=t.target.closest("[data-register]"),e=O.ELM[i.getAttribute("data-target")];if("true"===e.getAttribute("data-hidden")){O.CSS.add(i,"toggled"),e.removeAttribute("data-hidden");var s=e.getAttribute("data-on-toggle");s&&(e.setAttribute("data-register",s),this.register(e))}else O.CSS.remove(i,"toggled"),e.setAttribute("data-hidden","true"),e.removeAttribute("data-register")}function c(t,i){void 0!==O.ELM.connectionError&&O.DOM.remove(O.ELM.connectionError),this.state.username=i.username,t&&t()}return this.registry=this.registry||{},this.state=this.state||{},this.registry.appContainer={preprocess:function(i,e){document.title=O.TPL.translate("app.title"),this.state=this.extend(this.state,this.getMappedArguments());var s=this.isAuthenticated(),n=e.bind(e,{showUserDetailsInHeader:s,pageTemplate:this.getPageTemplateName()});s?this.api.getUser(t.bind(this,n)):n()}.bind(this)},this.registry.btnCancel={attributes:{onclick:i}},this.registry.endorse={attributes:{onclick:e.bind(this,"endorse",this.simplyReturn)}},this.registry.follow={attributes:{onclick:e.bind(this,"follow",this.simplyReturn)}},this.registry.read={attributes:{onclick:e.bind(this,"read",this.simplyReturn)}},this.registry.notFoundPage={preprocess:n.bind(this)},this.registry.frmPageNotFound={attributes:{onsubmit:r}},this.registry.pageNotFoundURL={attributes:{value:window.location.hash}},this.isAuthenticated=function(){var t=O.COOKIE("authToken");return t.length>0}.bind(this),this.updateURL=function(t){history.pushState({},t,location.href.split("#")[0]+"#"+t),this.renderPage()}.bind(this),this.getPageTitleFromHash=function(t){if(t.length){for(var i=t[0].key,e=1;e<t.length;e++){var s=t[e].key;i+=" "+s.substr(0,1).toUpperCase()+s.substr(1)}return i}return""}.bind(this),this.getPageTemplateName=function(){var t=this.extractArgumentsFromLocationHash(),i=this.getPageTitleFromHash(t),e=(i.length?i.replace(/\s/g,""):this.isAuthenticated()?"home":"welcome")+"Page";if(O.ELM.appContainer.setAttribute("data-section",t.length>0?t[0].key:"home"),-1===O.TPL.list().indexOf(e)){var s=this.registry[e];void 0!==s&&void 0!==s.preprocess?s.preprocess(null,function(){}):(this.log("trying to access "+e,this.logType.debug),e="notFoundPage")}return e}.bind(this),this.renderPage=function(){var t=this.getPageTemplateName();this.state=this.extend(this.state,this.getMappedArguments()),O.ELM.pageContainer.setAttribute("data-register",t),this.register(O.ELM.pageContainer)}.bind(this),window.onhashchange=this.renderPage.bind(this),this.registry.archive={attributes:{onclick:a.bind(this)}},this.removeArchiveButton=function(t,i){var e=document.querySelector("".concat('[data-register="archive"][data-type="',t,'"][data-id="',i,'"]'));e&&O.DOM.remove(e)},this.registry.toggle={attributes:{onclick:h.bind(this)}},this.updateCount=function(t,i,e){if(t){var s=t.querySelector('[data-role="'+i+'-count"]');if(s){var n=+s.innerHTML+e;return s.innerHTML=n,n}}return 0}.bind(this),this.ping=function(t){this.api.ping(c.bind(this,t))}.bind(this),this.registry.ping={preprocess:function(t,i){t.onclick=O.EVT.subscribe("ping",this.api.ping.bind(this,c)).getDispatcher("ping"),i()}.bind(this)},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){for(var i=t.length,e={};i--;)e[t[i]]=!0;return e}function i(i){--i.progress||(this.templates=t(O.TPL.list()),O.ELM.refresh(),this.register(O.ELM.appContainer))}return this.registry=this.registry||{},this.state=this.state||{},this.templates=this.templates||{},this.onConnectionError=function(){void 0===O.ELM.connectionError&&this.notify({notifyErrorConnection:{}})}.bind(this),this.init=function(){var t={progress:3};O.EVT.subscribe("window.onload",i.bind(this,t)).subscribe("TPL.templatesLoaded",i.bind(this,t)).subscribe("TPL.languageLoaded",i.bind(this,t)).subscribe("connection-error",this.onConnectionError),O.TPL.load("templates.html"),O.TPL.setLocale("en-us"),O.TPL.loadLanguage("i18n/en-us.json")}.bind(this),this.init(),this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){var e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.onchange=i.bind(this,t.target),e.click(),!1}function i(t,i){var s=i.target.files[0],n=new FileReader;return n.onload=e.bind(this,t),n.readAsDataURL(s),!1}function e(t,i){try{var e=t.getBoundingClientRect();o.call(this,i.target.result,e.width,e.height,s.bind(this,t))}catch(n){this.log(n)}return!1}function s(t,i){t.src=i,t.setAttribute("data-dirty",!0),document.querySelector('[data-register="imageRemove"][data-target="'+t.id+'"]').removeAttribute("disabled")}function n(t){var i=t.target,e=O.ELM[i.getAttribute("data-target")];return e.removeAttribute("src"),e.setAttribute("data-dirty","true"),i.setAttribute("disabled","disabled"),!1}function r(t){var i=O.ELM[t.target.getAttribute("data-target")];return i.src=this.api.getProfileImageURL(this.state.membershipJSON.id),i.setAttribute("data-dirty","false"),document.querySelector('[data-register="imageRemove"][data-target="'+i.id+'"]').removeAttribute("disabled"),!1}function a(t){var i=t.target,e=O.ELM[i.getAttribute("data-target")],n=e.getBoundingClientRect();return o.call(this,i.src,n.width,n.height,s.bind({},e)),!1}function o(t,i,e,s){var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=h.bind(this,n,i,e,s),n.src=t}function h(t,i,e,s){if(t.width>1e3||t.height>1e3)return void this.log(O.TPL.translate("error.imageTooBig").replace("[width]",1e3).replace("[height]",1e3),this.logType.error);var n=1,r=document.createElement("canvas");r.style.display="none",document.body.appendChild(r);var a=r.getContext("2d");a.drawImage(t,0,0);var o=document.createElement("canvas");o.style.display="none",document.body.appendChild(o);var h=r.getContext("2d"),c=o.getContext("2d");t.width>i?n=i/t.width:t.height>e&&(n=e/t.height),o.width=t.width,o.height=t.height,c.drawImage(t,0,0);var u=t.width*n,d=t.height*n;r.width=i,r.height=e,h.drawImage(o,(i-u)/2,(e-d)/2,u,d);var m=r.toDataURL("image/png");document.body.removeChild(r),document.body.removeChild(o),s(m)}return this.registry=this.registry||{},this.registry.imageUpload={attributes:{onclick:t.bind(this)}},this.registry.imageRemove={attributes:{onclick:n.bind(this)}},this.registry.imageReset={attributes:{onclick:r.bind(this)}},this.registry.copyImage={attributes:{onclick:a.bind(this)}},this.resizeImage=o.bind(this),this.getImageList=function(t,i){for(var e=t.length,s=[];e--;){var n=t[e];n!==i&&s.push(this.api.getProfileImageURL(n))}return{image:s}},this}.call(app),app="undefined"!=typeof app?app:{},function(){function t(t,e){if(Object.keys(e).length>0){for(var s=[],n=t.length,r=0;n>r;r++){var a=i(this.clone(t[r]),e);a&&(s[s.length]=a)}return s}return t}function i(t,i){for(var e=Object.keys(i);e.length;){var s=e.pop(),n=i[s];if(!(t[s].indexOf(n)>-1))return!1;t[s]=t[s].replace(n,O.TPL.render({selectedText:{text:n}}))}return t}return this.getFilteredItems=t,this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(){location.href;return html2canvas(document.body,{onrendered:i.bind(this)}),!0}function i(t){window.setTimeout(s.bind(this,t.toDataURL(),url),1)}function e(t,i){document.title=O.TPL.translate("title.feedback"),i()}function s(t,i){O.ELM.url.value=i,O.ELM.screenshotSample.src=t,O.ELM.screenshotRow.removeAttribute("data-hidden"),this.resizeImage(t,1280,1280,n)}function n(t){O.ELM.image.value=t}function r(t){try{var i=this.getFormFields(t.target);i.feedbackIncludesScreenshot||delete i.image,this.api.feedback(i,a.bind(this))}catch(e){this.log(e,"debug")}return!1}function a(){this.notify({notifySuccessFeedbackSent:{}})}return this.registry=this.registry||{},this.registry.sendFeedback={attributes:{onclick:t.bind(this)}},this.registry.feedbackPage={preprocess:e},this.registry.frmFeedback={attributes:{onsubmit:r.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){if(!this.isAuthenticated())return history.back(),e({}),!1;document.title=O.TPL.translate("title.communitySettings");var s=this.state.community;void 0!==s&&s.length>0?this.api.async({getCommunity:this.api.getCommunity.bind(this,s),getAllUserImages:this.api.getAllUserImages.bind(this)},i.bind(this,e)):this.updateURL("communities","")}function i(t,i){var e=i.getCommunity.community,s=i.getCommunity.membership;if(this.state.communityJSON=e,this.state.membershipJSON=s,void 0===s||"active"!==s.status)return void this.updateURL("community:"+e.id+"/");document.title="".concat(e.name," ",O.TPL.translate("title.settings"));var n={communityId:e.id,communityName:e.name,hasImage:s.hasImage,profileImage:s.hasImage?this.api.getProfileImageURL(s.id):"",images:this.getImageList(i.getAllUserImages.images,s.id)};n.memberName=s.name,n.email=this.state.email,t(n)}function e(t){var i=O.ELM.profileImagePreview;try{var e={membership:this.getDirtyFormFields(t.target)};e.membershipImage=i.src,Object.keys(e.membership).length>0||i.getAttribute("data-dirty")?this.api.updateMembership(this.state.membershipJSON.id,e,this.updateURL.bind({},"community:"+this.state.community+"/")):this.updateURL("community:"+this.state.community+"/")}catch(s){if(s.errors.length)for(var n=s.errors.length;n--;)this.log(s.errors[n],this.logType.error)}return!1}function s(t){var i=t.target;if(this.setValidationMessage(i,O.TPL.translate("message.checkingIfNameBeingUsed")),i.value.length>0){var e={membership:{communityId:this.state.community,name:i.value}};this.api.membershipExists(e,n.bind(this,i))}else this.setValidationMessage(i,O.TPL.translate("message.thisFieldIsRequired"))}function n(t,i){this.setValidationMessage(t,"false"===i.exists?O.TPL.translate("message.namedAlreadyBeingUsed"):"")}return this.registry=this.registry||{},this.registry.communitySettingsPage={preprocess:t.bind(this)},this.registry.frmMembershipSettings={attributes:{onsubmit:e.bind(this)}},this.registry.uniqueMemberName={attributes:{onchange:s.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){var e=i.getCommunity.community,s=i.getCommunity.membership;document.title=e.name,this.state.communityJSON=e,e.membership=s;var n=!!s&&"active"===s.status,r={communityId:e.id,communityName:e.name,isMember:n,topics:{topic:[]}};r.isMember?r.memberName=e.membership.name?i.getCommunity.membership.name:"":r.joinLink=this.isAuthenticated()?"#community:{{communityId}}/join":"#join",r.email=this.state.user?this.state.user.email:"",t(r)}function i(t){return this.confirm(O.TPL.translate("confirm.leaveCommunity"),e.bind(this)),!1}function e(t){t&&this.api.quitCommunity(this.state.community,s.bind(this))}function s(){delete this.state.community,delete this.state.communityJSON,this.updateURL("community/",O.TPL.translate("pageTitle.community"))}return this.registry=this.registry||{},this.registry.communityPage={preprocess:function(i,e){var s=this.state.community;void 0!==s&&s.length>0?this.api.async({getCommunity:this.api.getCommunity.bind(this,s)},t.bind(this,e)):this.updateURL("communities","")}.bind(this)},this.registry.btnLeave={attributes:{onclick:i.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){var n=this.registry.communityList.cached;document.title=O.TPL.translate("title.communities"),n?e({communities:{community:this.getFilteredItems.call(this,n,s)}}):this.api.getCommunityList(i.bind(this,e))}function i(t,i){var e=i.communities;this.state.communities=e,t({communities:{community:this.getFilteredItems.call(this,e,s)}})}function e(t){s.name=t.target.value,this.registry.communityList.cached=this.state.communities,this.register(document.querySelector('[data-register="communityList"]')),delete this.registry.communityList.cached}this.registry=this.registry||{};var s={};return this.registry.communitiesPage={preprocess:function(t,i){i({isAuthenticated:this.isAuthenticated()})}.bind(this)},this.registry.communityList={preprocess:t.bind(this)},this.registry.filterCommunities={attributes:{onkeyup:e.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){var e=i.getCommunity.community,s=i.getCommunity.membership;s&&"active"===s.status?this.updateURL("community:"+e.id+"/"):s={name:"",hasImage:!1,id:void 0};var n={isAuthenticated:this.isAuthenticated(),communityId:e.id,communityName:e.name,memberName:s.name,hasImage:s.hasImage,profileImage:"",images:this.getImageList(i.getAllUserImages.images,s.id)};t(n)}function i(t){var i=O.ELM.profileImagePreview,s={membership:this.getFormFields(t.target),membershipImage:"true"===i.getAttribute("data-dirty")?i.src:void 0},n=this.state.community;return this.api.joinCommunity(n,s,e.bind(this,n)),!1}function e(t,i){i instanceof Error?409===i.status?this.updateURL("community:"+t+"/"):(this.log(i,this.logType.debug),alert("failed to join community")):this.updateURL("community:"+t+"/")}return this.registry=this.registry||{},this.registry.communityJoinPage={preprocess:function(i,e){document.title=O.TPL.translate("title.communityJoin");var s=this.state.community;void 0!==s&&s.length>0?this.api.async({getCommunity:this.api.getCommunity.bind(this,s),getAllUserImages:this.api.getAllUserImages.bind(this)},t.bind(this,e)):this.updateURL("communities","")}.bind(this)},this.registry.frmJoinCommunity={attributes:{onsubmit:i.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){return this.isAuthenticated()?void this.api.async({getMyMemberships:this.api.getMyMemberships.bind(this),getAllUserImages:this.api.getAllUserImages.bind(this)},i.bind(this,e)):(history.back(),e({}),!1)}function i(t,i){for(var e=i.getMyMemberships.memberships,s="",n=0,r={},a=e.length;a--;){var o=e[a].name,h=r[o];h=void 0===r[o]?1:h+1,r[o]=h,h>=n&&(s=o,n=h)}t({founderName:s,hasImage:!1,profileImage:"",images:this.getImageList(i.getAllUserImages.images,void 0)})}function e(t){var i=t.target,e=this.getFormFields(i);return"sending"!==i.getAttribute("data-status")&&(i.setAttribute("data-status","sending"),this.api.addCommunity({community:{name:e.name,description:e.description},founder:{name:e.founderName},founderImage:O.ELM.profileImagePreview.src},s.bind(this,i))),!1}function s(t,i){t.setAttribute("data-status",""),i instanceof Error||!i?(this.notify({notifySystem:{message:O.TPL.translate("notify.failedToAddCommunity"),status:"error"}}),this.log(i,this.logType.debug)):this.updateURL("community:"+i.community.id+"/")}function n(t){var i=t.target;this.setValidationMessage(i,O.TPL.translate("message.checkingIfNameBeingUsed")),i.value.length>0?this.api.communityExists({community:{name:i.value}},r.bind(this,i)):this.setValidationMessage(i,O.TPL.translate("message.thisFieldIsRequired"))}function r(t,i){this.setValidationMessage(t,i.exists?O.TPL.translate("message.namedAlreadyBeingUsed"):"")}return this.registry=this.registry||{},this.registry.communityAddPage={preprocess:t.bind(this)},this.registry.frmAddCommunity={attributes:{onsubmit:e.bind(this)}},this.registry.uniqueCommunityName={attributes:{onchange:n.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i,e,s){for(var n=s.comments||[],r=s.authors||{},a=this.state.communityJSON.membership?this.state.communityJSON.membership.id:!1,o=n.length;o--;){var h=n[o];h.author=r[h.authorId],h.author.image=this.api.getProfileImageURL(h.author.id),h.isEditable=a===h.author.id&&0===h.comments&&0===h.endorse,h.isArchivable=h.isEditable,h.isMember=!!a,h.time=moment(h.modified).format("MMM Do YY, h:mma"),h.relativeTime=moment(h.modified).fromNow(),h.isEditable&&(h.opinionId=t?t:"",h.parentId=i?i:"")}e({id:"",opinionId:t?t:"",parentId:i?i:"",content:"",comments:{comment:n}})}function i(t){var i,s,n=t.target,r=this.getFormFields(n);return r.parentId.length>0?(i="comment",s=r.parentId):(i="opinion",s=r.opinionId,delete r.parentId),0===r.id.length&&delete r.id,this.models.comment.content.validate(r.content,this.state.communityJSON)?this.api.setComment({comment:r},e.bind(this,n,i,s,void 0===r.id)):this.log("bad comment",this.logType.error),!1}function e(t,i,e,s){if(s){var n=O.ELM[i+"-"+e];this.updateCount(n,"comment",1),this.removeArchiveButton(i,e)}this.register(O.ELM["".concat(i,"-",e,"-comments")])}return this.registry=this.registry||{},this.registry.commentList={preprocess:function(i,e){var s=i.getAttribute("data-opinion-id"),n=i.getAttribute("data-comment-id");this.api.getPostComments(s,n,t.bind(this,s,n,e))}.bind(this)},this.registry.frmSetComment={attributes:{onsubmit:i.bind(this)}},this}.call(app),app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){var e=O.COOKIE("authToken");if(void 0!==e)return{credentials:e};if(t)return{};var s=new Error("unauthorized");return i(s),s}function i(t,i,e,s,n){s[t]=n,0===--i.counter&&e(s)}function e(t,i){this.api.get("topic/"+t+"/opinions",i,!0)}function s(t,i){t.opinion.id?this.api.post("opinion/"+t.opinion.id,t,i):t.opinion.topicId?this.api.put("topic/"+t.opinion.topicId+"/opinions",t,i):i(new Error("missing-details"))}return this.api=this.api||{backend:server,cache:{},cacheExpiration:18e4},this.api.saveToCache=function(t,i,e){this.api.cache[t]={modified:(new Date).getTime(),response:e},i(e)}.bind(this),this.api.get=function(i,e,s){var n=t(s,e);if(!(n instanceof Error)){var r=this.api.cache;r[i]&&r[i].modified>(new Date).getTime()-this.api.cacheExpiration?e(r[i].response):O.AJAX.get(this.api.backend+i,this.api.ifNotError.bind(this,this.api.saveToCache.bind(this,i,e)),n)}}.bind(this),this.api["delete"]=function(i,e,s){var n=t(s,e);n instanceof Error||(this.api.clearCache(),O.AJAX["delete"](this.api.backend+i,this.api.ifNotError.bind(this,e),n))}.bind(this),this.api.post=function(i,e,s,n){var r=t(n,s);r instanceof Error||(this.api.clearCache(),O.AJAX.post(this.api.backend+i,e,this.api.ifNotError.bind(this,s),r))}.bind(this),this.api.put=function(i,e,s,n){var r=t(n,s);r instanceof Error||(this.api.clearCache(),O.AJAX.put(this.api.backend+i,e,this.api.ifNotError.bind(this,s),r))}.bind(this),this.api.clearCache=function(t){void 0===t?this.api.cache={}:delete this.api.cache[t]}.bind(this),this.api.ifNotError=function(t,i){i instanceof Error&&this.log(i,this.logType.debug),i instanceof Error&&0===i.status?O.EVT.dispatch("connection-error",i.message):t(i)}.bind(this),this.api.async=function(t,e){for(var s=Object.keys(t),n={},r={counter:s.length};s.length;){var a=s.pop(),o=t[a];o(i.bind(this,a,r,e,n))}}.bind(this),this.api.ping=function(t){this.api.get("ping",this.api.ifNotError.bind(this,t),!0)}.bind(this),this.api.postConnectionToken=function(t,i,e,s){var n={email:t,subject:i,content:e};this.api.post("user/connect/",n,s)}.bind(this),
this.api.getAuthToken=function(t,i){this.api.get("user/connect/"+t,i)}.bind(this),this.api.getUser=function(t){this.api.get("user/",t)}.bind(this),this.api.getAllUserImages=function(t){this.api.get("membership/all/images",t)}.bind(this),this.api.updateProfileImage=function(t,i,e){this.api.put("".concat("membership/",t,"/image"),i,e)}.bind(this),this.api.getProfileImageURL=function(t){return"".concat(this.api.backend,"membership/",t,"/image")}.bind(this),this.api.updateMembership=function(t,i,e){this.api.post("".concat("membership/",t),i,e)}.bind(this),this.api.membershipExists=function(t,i){this.api.post("".concat("membership/exists"),t,i)}.bind(this),this.api.addCommunity=function(t,i){this.api.put("community/",t,i)}.bind(this),this.api.getCommunityList=function(t){this.api.get("community/",t,!0)}.bind(this),this.api.getMyMemberships=function(t){this.api.get("membership/",t)}.bind(this),this.api.getCommunity=function(t,i){this.api.get("community/"+t+"/",i,!0)}.bind(this),this.api.getCommunityTopics=function(t,i){this.api.get("community/"+t+"/topics/",i,!0)}.bind(this),this.api.joinCommunity=function(t,i,e){this.api.put("community/"+t+"/membership/",i,e)}.bind(this),this.api.quitCommunity=function(t,i){this.api.clearCache("community/"),this.api.get("community/"+t+"/quit/",i)}.bind(this),this.api.communityExists=function(t,i){this.api.post("community/exists",t,i)}.bind(this),this.api.archive=function(t,i,e){this.api["delete"]("".concat(t,"/",i),e)}.bind(this),this.api.getCommunityTopics=function(t,i){this.api.get("community/"+t+"/topics",i,!0)}.bind(this),this.api.setTopic=function(t,i){this.api.post("topic/",t,i)}.bind(this),this.api.getTopicOpinions=e.bind(this),this.api.setOpinion=s.bind(this),this.api.getPostComments=function(t,i,e){i?this.api.get("comment/"+i+"/comments",e):t?this.api.get("opinion/"+t+"/comments",e):e(new Error("missing-details"))}.bind(this),this.api.setComment=function(t,i){var e=t.comment;e.id?this.api.post("comment/"+e.id,t,i):e.parentId?this.api.put("comment/"+e.parentId+"/comments",t,i):e.opinionId?this.api.put("opinion/"+e.opinionId+"/comments",t,i):i(new Error("missing-details"))}.bind(this),this.api.feedback=function(t,i){this.api.put("feedback/",t,i,!0)}.bind(this),this.api.setAttribute=function(t,i,e,s){this.api.get("".concat(t,"/",i,"/",e),s)}.bind(this),this}.call(app);