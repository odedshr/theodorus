Theodorus.namespace("feed").AddTopicController=Class.extend({init:function(e){this.parent=e,this.view=new Theodorus.feed.AddTopicView,this.view.setController(this)},submit:function(e,t,o){$.post(e,t,o)},isSlugAvailable:function(e,t){0===e.length?t({result:"slug-is-too-short"}):Topic.isSlugValid(e)?t({result:"slug-is-available"}):t({result:"slug-is-invalid"})},URLPrefix:function(){return document.URL.match(/^http[s]?:\/\/[a-zA-Z0-9\.\-_]*(:(\d)*)?\//)[0]+"*"},me:function(){return this.parent.me()}}),Theodorus.namespace("feed").FeedController=Class.extend({init:function(e){_.bindAll(this,"openAddTopicWindow"),this.parent=e,this.view=new Theodorus.feed.FeedView,this.view.setController(this),this.account=new Theodorus.user.AccountController(this),this.topics=new Theodorus.feed.TopicListController(this)},render:function(){var e=this;this.view.render(function(){e.account.view.setup(),e.topics.load()})},openAddTopicWindow:function(){this.addTopic=new Theodorus.feed.AddTopicController(this),this.addTopic.view.setAsPopUp(!0),this.addTopic.view.render()},me:function(){return this.parent.me()}}),Theodorus.namespace("feed").TopicListController=Class.extend({init:function(e){this.parent=e,this.view=new Theodorus.feed.TopicListView,this.view.setController(this),this.collection=new Topics,_.bindAll(this,"load","loadCallback")},loadCallback:function(){this.collection.models.forEach(function(e){var t=e.get("initiator");"object"==typeof t&&e.set("initiator",new User(t))}),this.render()},load:function(){this.collection.fetch({reset:!0,success:this.loadCallback,error:this.loadCallback})},render:function(){this.view.render()},me:function(){return this.parent.me()}}),_.extend(Theodorus.namespace("tools.MessageController"),{hey:function(){alert("Hello!")}}),Theodorus.namespace("user").AccountController=Class.extend({init:function(e){this.parent=e,this.view=new Theodorus.user.AccountView,this.view.setController(this),_.bindAll(this,"openAuthenticationWindow","onAuthenticationCompleted","signout")},openAuthenticationWindow:function(e){var t=e?new Theodorus.user.SigninController(this):new Theodorus.user.SignupController(this);t.callback=this.onAuthenticationCompleted,t.view.setAsPopUp(!0),t.view.render()},onAuthenticationCompleted:function(e){Theodorus.onAccountLoaded(e)},signout:function(){var e=this;return $.ajax({url:"/me",type:"DELETE",success:e.onAuthenticationCompleted})}}),Theodorus.namespace("user").SigninController=Class.extend({init:function(e){this.parent=e,this.view=new Theodorus.user.SigninView,this.view.setController(this),this.callback=ExternalWindow.windowCallback,$.getScript("/lib/md5.js",function(){}),_.bindAll(this,"submit")},submit:function(e,t){var o=this,i=t.password;t.password=md5(i),t.md5=!0,$.post(e,t,function(e){e.error?console.error(e.error):(o.view.cancel(),o.callback(e))})},user:function(){return this.parent.user}});var MIN_PASSWORD_LENGTH=3;Theodorus.namespace("user").SignupController=Class.extend({init:function(e){this.parent=e,this.view=new Theodorus.user.SignupView,this.view.setController(this),$.getScript("/lib/md5.js",function(){})},submit:function(e,t){var o=t.password,i=t.password_repeat;return t.terms_of_use?o!=i?{error:"passwords-dont-match"}:MIN_PASSWORD_LENGTH>o.length?{error:"passwords-too-short"}:1>this.verifyPasswordComplexity(o)?{error:"passwords-too-simple"}:(t.password=md5(o),t.password_repeat=md5(i),t.md5=!0,$.post(e,t,ExternalWindow.windowCallback),void 0):{error:"terms-of-use-not-approved"}},verifyPasswordComplexity:function(e){return/(?=^.{8,}$)(?=.*\d)(?=.*\W+)(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/.test(e)?4:/(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/.test(e)?3:/(?=^.{6,}$)(?=.*\d)(?=.*[A-Za-z]).*$/.test(e)?2:/[a-zA-Z0-9\_\-]{3,}$/i.test(e)?1:0},me:function(){return this.parent.me}});