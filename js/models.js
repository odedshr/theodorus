var Backbone=Backbone||require("Backbone"),AbstractModel=Backbone.Model.extend({autoId:!1,initialize:function(e){var t=this.schema;for(var i in t)if(e&&e[i])this.set(i,e[i]);else switch(t[i]){case"number":this[i]=0;break;case"boolean":this[i]=!1;break;case"array":this[i]=[];break;default:this[i]=null}},xml:function(){var e=this.constructor.name;return"<"+e+" />"},xmlAttribute:function(e){var t=this.get(e);if("undfined"==t)return"";if("object"==typeof t&&t.xml)return t.xml();if("date"==this.schema[e]&&"undefined"!=typeof prettyDate){var i=prettyDate(t);return"<"+e+" timestamp='"+t+"' value='"+i.replace(/(\D)./g,"")+"'>"+i.replace(/(\d)./g,"x")+"</"+e+">"}return"<"+e+">"+t+"</"+e+">"}}),AbstractCollection=Backbone.Collection.extend({name:"collection",xml:function(){var e="";return this.forEach(function(t){e+="\n	"+t.xml()}),"<"+this.name+">"+e+"</"+this.name+">"}});"undefined"!=typeof exports&&(exports.model=function(){return AbstractModel},exports.collection=function(){return AbstractCollection});var Credentials=(AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model()).extend({collection:"credentials",key:"auth_key",schema:{auth_key:"string",password:"string",user_id:"number"}});"undefined"!=typeof exports&&(exports.model=function(){return Credentials});var VALID_REPORT_STATUS=["na","questioned","ok","irrelevant","offensive","spam","violent"],VALID_STATUS=["idea","discussion","proposition","decision"],AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model();AbstractCollection=AbstractCollection!==void 0?AbstractCollection:require("./AbstractModel").collection();var Topic=AbstractModel.extend({autoId:!0,defaults:{report_status:VALID_REPORT_STATUS[0],status:VALID_STATUS[0]},collection:"topics",key:"topic_id",schema:{topic_id:"number",slug:"string",tags:"array",created:"date",modified:"date",initiator:"number",title:"string",endorsements:"number",follows:"number",status:"string",reports:"string",report_status:"string",score:"number",minimum_votes_required:"number"},xml:function(){return'<topic id="'+this.get("topic_id")+'">'+this.xmlAttribute("title")+this.xmlAttribute("created")+this.xmlAttribute("modified")+this.xmlAttribute("initiator")+"</topic>"}});Topic.isSlugValid=function(e){return/^[a-z0-9\-\._]{5,140}$/.test(e)},Topic.Read=AbstractModel.extend({collection:"topic_read",key:"topic_id",schema:{topic_id:"number",content:"string"}}),Topic.Write=AbstractModel.extend({collection:"topic_write",key:"topic_id",schema:{topic_id:"number",title:"string",content:"string"}});var Topics=AbstractCollection.extend({name:"topics",url:"/topics",model:Topic});"undefined"!=typeof exports&&(exports.model=function(){return Topic});var DEFAULT_LANGUAGE="he",VALID_STATUS=["guest","participant","resident","citizen","delegate"],User=(AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model()).extend({autoId:!0,defaults:{language:DEFAULT_LANGUAGE,status:VALID_STATUS[0],permissions:[],badges:[],penalties:[]},validate:function(e){return e.status&&-1==VALID_STATUS.indexOf(e.status)?"can't end before it starts":void 0},can:function(e){return-1!=this.get("permissions").indexOf(e)},xml:function(){var e=this.toJSON();return"<user"+(e.user_id?' id="'+e.user_id+'"':"")+">"+(e.email?"<email>"+e.email+"</email>":"")+(e.display_name?"<display_name>"+e.display_name+"</display_name>":"")+(e.SN?"<sn>"+e.SN+"</sn>":"")+(e.slug?"<slug>"+e.slug+"</slug>":"")+(e.bio?"<bio>"+e.bio+"</bio>":"")+(e.picture?"<picture>"+e.picture+"</picture>":"")+(e.birthday?"<birthday>"+e.birthday+"</birthday>":"")+(e.language?"<language>"+e.language+"</language>":"")+(e.status?"<status>"+e.status+"</status>":"")+(e.score?"<score>"+e.score+"</score>":"")+"</user>"},collection:"users",key:"user_id",schema:{user_id:"number",display_name:"string",slug:"string",bio:"string",picture:"string",score:"number",penalties:"array",badges:"array"}});User.Account=User.extend({schema:{user_id:"number",email:"string",display_name:"string",SN:"string",slug:"string",bio:"string",picture:"string",birthday:"string",language:"string",isVerified:"boolean",isModerator:"boolean",isDelegate:"boolean",status:"string",score:"number",penalties:"array",badges:"array",permissions:"array"}}),"undefined"!=typeof exports&&(exports.model=function(){return User});