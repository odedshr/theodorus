var Backbone=Backbone||require("backbone"),AbstractModel=Backbone.Model.extend({autoId:!1,initialize:function(e){if(this.schema===void 0)throw"model-has-no-schema";var t=this.schema;for(var o in t)if(e&&e.hasOwnProperty(o))this.set(o,e[o]);else switch(t[o]){case"number":this[o]=0;break;case"boolean":this[o]=!1;break;case"array":this[o]=[];break;default:this[o]=null}}}),AbstractCollection=Backbone.Collection.extend({name:"collection",getPage:function(){if(this.url===void 0)throw"called-getPage-on-collection-with-no-url";var e=this.url.match(/:\d+/);return e?1*e[0].replace(/\D/g,""):1},setPage:function(e){if(this.url===void 0)throw"called-setPage-on-collection-with-no-url";if(isNaN(e))throw"pageNum-parameter-must-be-a-number";var t=this.url.match(/:\d+/);return this.url=t?this.url.replace(/:\d+/,":"+e):(this.url+"/:"+e).replace(/\/\/:/,"/:"),this}});"undefined"!=typeof exports&&(exports.model=function(){return AbstractModel},exports.collection=function(){return AbstractCollection});var VALID_REPORT_STATUS=["na","questioned","ok","irrelevant","offensive","spam","violent"],AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model(),Comment=AbstractModel.extend({autoId:!0,defaults:{endorse:0,follow:0,report:0,report_status:VALID_REPORT_STATUS[0]},collection:"comments",key:"comment_id",schema:{topic_id:"number",comment_id:"number",opinion_id:"number",parent_id:"number",user_id:"number",created:"date",content:"string",tags:"array",follow:"number",endorse:"number",report:"number",report_status:"number"}});"undefined"!=typeof exports&&(exports.model=function(){return Comment});var AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model(),Community=AbstractModel.extend({autoId:!0,collection:"communities",key:"community_id",schema:{community_id:"number",name:"string",settings:"string"}});"undefined"!=typeof exports&&(exports.model=function(){return Community});var Credentials=(AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model()).extend({collection:"credentials",key:"auth_key",schema:{auth_key:"string",password:"string",user_id:"number"}});"undefined"!=typeof exports&&(exports.model=function(){return Credentials}),function(){var e=e!==void 0?e:require("./AbstractModel").model(),t=e.extend({autoId:!1,collection:"model_update",key:"model",schema:{model:"string",modified:"date"}});"undefined"!=typeof exports&&(exports.model=function(){return t})}();var AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model();AbstractCollection=AbstractCollection!==void 0?AbstractCollection:require("./AbstractModel").collection();var Notification=AbstractModel.extend({xml:function(){var e=JSON.parse(this.get("responseText"));return'<message type="'+_.keys(e)[0]+'">'+"\n	"+_.values(e)[0]+"</message>"}});"undefined"!=typeof exports&&(exports.model=function(){return Notification});var VALID_REPORT_STATUS=["na","questioned","ok","irrelevant","offensive","spam","violent","selfcensor"],VALID_STATUS=["idea","discussion","proposition","decision","removed"],AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model();AbstractCollection=AbstractCollection!==void 0?AbstractCollection:require("./AbstractModel").collection();var Topic=AbstractModel.extend({autoId:!0,defaults:{seen:0,tags:{tag:[]},endorse:0,follow:0,report:0,opinion:0,comment:0,report_status:VALID_REPORT_STATUS[0],status:VALID_STATUS[0],score:0},extra:function(e,t){var o=this.get("extra");return 2==arguments.length?(o=o?o:{},o[e]=t,this.set("extra",o)):o?o[e]:null},collection:"topics",key:"topic_id",schema:{topic_id:"number",slug:"string",created:"date",modified:"date",initiator:"number",title:"string",tags:"array",seen:"number",follow:"number",endorse:"number",report:"number",opinion:"number",comment:"number",votes_required:"number",status:"number",report_status:"number",score:"number",extra:"object"}});Topic.isSlugValid=function(e){return/^[a-zA-Z0-9\-\.%_]{5,140}$/.test(e)},Topic.Read=AbstractModel.extend({collection:"topic_read",key:"topic_id",schema:{topic_id:"number",content:"string"}}),Topic.Alternative=AbstractModel.extend({collection:"topic_write",key:"alt_id",schema:{alt_id:"number",topic_id:"number",section:"number",content:"string",votes:"number",opposition:"number"}}),"undefined"!=typeof exports&&(exports.model=function(){return Topic});var DEFAULT_LANGUAGE="he",AbstractModel=(AbstractModel!==void 0?AbstractModel:require("./AbstractModel")).model(),User=AbstractModel.extend({autoId:!0,defaults:{score:0,language:DEFAULT_LANGUAGE,permissions:{}},can:function(e){var t=this.get("permissions");t===void 0&&(t={},this.set("permissions",t));var o=t[e];return o!==void 0&&o},collection:"users",key:"user_id",schema:{user_id:"number",slug:"string",display_name:"string",score:"number",badges:"array",isPolitician:"boolean",bio:"string"}});User.initialPermissions={suggest:!0,feedback:!0,comment:!0},User.Account=User.extend({schema:{user_id:"number",slug:"string",display_name:"string",SN:"string",isSNVerified:"boolean",isModerator:"boolean",isPolitician:"boolean",picture:"string",birthday:"string",language:"string",score:"number",penalties:"number",permissions:"array",revoked:"array",badges:"array"}}),User.Topic={collection:"user_topic",key:["user_id","topic_id"],schema:{user_id:"number",topic_id:"number",seen:"boolean",follow:"boolean",endorse:"boolean",report:"boolean",score:"number"}},User.Comment={collection:"user_comment",key:["user_id","comment_id"],schema:{user_id:"number",comment_id:"number",seen:"boolean",follow:"boolean",endorse:"boolean",report:"boolean",score:"number"}},User.Tag={collection:"user_topic_tags",key:["user_id","topic_id"],schema:{user_id:"number",topic_id:"number",tag:"string"}},"undefined"!=typeof exports&&(exports.model=function(){return User});