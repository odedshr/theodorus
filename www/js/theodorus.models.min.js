var Backbone=Backbone||require("backbone"),AbstractModel=Backbone.Model.extend({autoId:!1,initialize:function(t){var e=this.schema;for(var r in e)if(t&&t.hasOwnProperty(r))this.set(r,t[r]);else switch(e[r]){case"number":this[r]=0;break;case"boolean":this[r]=!1;break;case"array":this[r]=[];break;default:this[r]=null}},xml:function(){var t=this.constructor.name;return"<"+t+" />"},xmlAttribute:function(t){var e=this.get(t);if("undfined"==e)return"";if(e&&"object"==typeof e&&e.xml)return e.xml();if("date"==this.schema[t]&&"undefined"!=typeof prettyDate)try{var r=new Date(e).format(),i=prettyDate(e),o=Number(i.replace(/\D/g,""));return"<"+t+" timestamp='"+e+"' formatted='"+r+"' value='"+o+"'>"+i.replace(/(\d)+/g,"#")+"</"+t+">"}catch(n){return""}return"<"+t+">"+e+"</"+t+">"}}),AbstractCollection=Backbone.Collection.extend({name:"collection",getPage:function(){var t=this.url.match(/:\d+/);return t?1*t[0].replace(/\D/g,""):0},setPage:function(t){var e=this.url.match(/:\d+/);this.url=e?this.url.replace(/:\d+/,":"+t):(this.url+"/:"+t).replace(/\/\/:/,"/:")},xml:function(){var t="";return this.forEach(function(e){t+="\n	"+e.xml()}),"<"+this.name+">"+t+"</"+this.name+">"}});"undefined"!=typeof exports&&(exports.model=function(){return AbstractModel},exports.collection=function(){return AbstractCollection});var Credentials=(AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model()).extend({collection:"credentials",key:"auth_key",schema:{auth_key:"string",password:"string",user_id:"number"}});"undefined"!=typeof exports&&(exports.model=function(){return Credentials});var AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model();AbstractCollection=AbstractCollection!==void 0?AbstractCollection:require("./AbstractModel").collection();var Notification=AbstractModel.extend({xml:function(){var t=JSON.parse(this.get("responseText"));return'<message type="'+_.keys(t)[0]+'">'+"\n	"+_.values(t)[0]+"</message>"}});"undefined"!=typeof exports&&(exports.model=function(){return Notification});var AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model();AbstractCollection=AbstractCollection!==void 0?AbstractCollection:require("./AbstractModel").collection();var Tag=AbstractModel.extend({autoId:!1,defaults:{count:0,color:"#FFFFFF"},collection:"tags",key:"tag",schema:{tag:"string",count:"number",color:"string"},xml:function(){return"<tag count='"+this.get("count")+"' color='"+this.get("color")+"'>"+this.get("tag")+"</tag>"}}),Tags=AbstractCollection.extend({name:"tags",url:"/tags",model:Tag});"undefined"!=typeof exports&&(exports.model=function(){return Tag});var VALID_REPORT_STATUS=["na","questioned","ok","irrelevant","offensive","spam","violent"],VALID_STATUS=["idea","discussion","proposition","decision"],AbstractModel=AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model();AbstractCollection=AbstractCollection!==void 0?AbstractCollection:require("./AbstractModel").collection();var Topic=AbstractModel.extend({autoId:!0,defaults:{seen:0,tags:[],endorse:0,follow:0,report:0,comment:0,report_status:VALID_REPORT_STATUS[0],status:VALID_STATUS[0],score:0},extra:function(t,e){var r=this.get("extra");return 2==arguments.length?(r=r?r:{},r[t]=e,this.set("extra",r)):r?r[t]:null},collection:"topics",key:"topic_id",schema:{topic_id:"number",slug:"string",created:"date",modified:"date",initiator:"number",title:"string",tags:"array",seen:"number",follow:"number",endorse:"number",report:"number",comment:"number",votes_required:"number",status:"number",report_status:"number",score:"number",extra:"object"},xml:function(){var t=this,e=function(e){var r=t.get(e),i=t.get("user_"+e);return r>0?"<"+e+" me='"+(i?"true":"false")+"'>"+(r?r:0)+"</"+e+">":""},r=this.get("slug");return'<topic id="'+this.get("topic_id")+'">'+"\n	"+this.xmlAttribute("title")+"\n	"+this.xmlAttribute("created")+"\n	"+this.xmlAttribute("modified")+"\n	"+"<url>"+("string"==typeof r&&r.length>0?"*"+r:"/topics/"+this.get("topic_id"))+"</url>"+"\n	"+this.xmlAttribute("tags")+"\n	"+this.xmlAttribute("initiator")+"\n	"+this.xmlAttribute("status")+"\n	"+this.xmlAttribute("report_status")+"\n	"+this.xmlAttribute("score")+"\n	"+this.xmlAttribute("extra")+"\n	"+this.xmlAttribute("comment")+"\n	"+e("seen")+"\n	"+e("follow")+"\n	"+e("endorse")+"\n	"+e("report")+"</topic>"}});Topic.isSlugValid=function(t){return/^[a-z0-9\-\._]{5,140}$/.test(t)},Topic.Read=AbstractModel.extend({collection:"topic_read",key:"topic_id",schema:{topic_id:"number",content:"string"}}),Topic.Alternative=AbstractModel.extend({collection:"topic_write",key:"alt_id",schema:{alt_id:"number",topic_id:"number",section:"number",content:"string",votes:"number",opposition:"number"}});var Topics=AbstractCollection.extend({name:"topics",url:"/topics",model:Topic});"undefined"!=typeof exports&&(exports.model=function(){return Topic});var DEFAULT_LANGUAGE="he",User=(AbstractModel!==void 0?AbstractModel:require("./AbstractModel").model()).extend({autoId:!0,defaults:{score:0,language:DEFAULT_LANGUAGE,permissions:{}},can:function(t){var e=this.get("permissions");return e===void 0||e[t]},xml:function(){var t=this.toJSON(),e=this.xmlAttribute("email")+this.xmlAttribute("display_name")+this.xmlAttribute("slug")+this.xmlAttribute("SN")+this.xmlAttribute("bio")+this.xmlAttribute("picture")+this.xmlAttribute("birthday")+this.xmlAttribute("language")+this.xmlAttribute("score")+this.xmlAttribute("badges");return"<user"+(t.user_id?' id="'+t.user_id+'"':"")+">"+e+"</user>"},collection:"users",key:"user_id",schema:{user_id:"number",slug:"string",display_name:"string",score:"number",badges:"array",isPolitician:"boolean",bio:"string"}});User.Account=User.extend({schema:{user_id:"number",slug:"string",display_name:"string",SN:"string",isSNVerified:"boolean",isModerator:"boolean",isPolitician:"boolean",picture:"string",email:"string",isEmailVerified:"boolean",birthday:"string",language:"string",score:"number",penalties:"number",permissions:"array",revoked:"array",badges:"array"}}),User.Topic={collection:"user_topic",key:["user_id","topic_id"],schema:{user_id:"number",topic_id:"number",seen:"boolean",follow:"boolean",endorse:"boolean",report:"boolean",score:"number"}},"undefined"!=typeof exports&&(exports.model=function(){return User});