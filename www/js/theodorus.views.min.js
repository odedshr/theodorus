/*! theodorus 2014-09-25 */
Theodorus.View=Backbone.View.extend({xslt:null,setController:function(a){this.controller=a},setup:function(a){return this.$el=this.$el?$(this.$el.selector):null,a&&a(),this},setAsPopUp:function(a){this.isPopup=a},transform:function(a,b){var c=$,d=b;!this.isPopup&&this.$el&&(0===this.$el.size()&&(this.$el=$(this.$el.selector)),this.$el.size()>0?c=this.$el:console.log("failed to find element ("+this.$el.selector+") for \n"+a)),this.isPopup&&(d=function(a){$("#popup_placeholder").append(a),b(a)}),c.transform({async:!1,xslCache:!0,xmlstr:"<xml>"+a+"</xml>",xsl:"/ui/xslt/default.xsl",success:d,error:function(b){alert("error transforming :"+b+"\n"+a)}})},getFormFields:function(a){var b=a.elements,c={};for(var d in b){var e=b[d];e.name&&(c[e.name]="checkbox"==e.type?e.checked:e.value)}return c}}),Theodorus.namespace("user").AccountView=Theodorus.View.extend({el:"#account",initialize:function(){_.bindAll(this,"openAuthenticationWindow")},render:function(a){var b=this;return this.transform(this.controller.user(),function(){b.setup(),a&&a()}),this},setup:function(a){var b=this;return $("#btn_signup").click(this.openAuthenticationWindow),$("#btn_signin").click(this.openAuthenticationWindow),$("#btn_signout").click(function(){return!b.controller.signout()}),Theodorus.View.prototype.setup.call(this,a)},openAuthenticationWindow:function(a){return this.controller.openAuthenticationWindow("signin"==a.target.id.replace(/btn_/,"")),!1}}),Theodorus.namespace("feed").FeedView=Theodorus.View.extend({el:"#main",initialize:function(){_.bindAll(this,"openAddTopicWindow","setup","render")},render:function(a){var b=this,c=this.controller.io.user,d='<page type="feed">'+c.xml()+(c.can("suggest")?"<addTopic/>":"")+"</page>";return this.transform(d,function(c){a&&a(b,c)}),this},setup:function(a){return $("#link_suggest_topic").click(this.openAddTopicWindow),Theodorus.View.prototype.setup.call(this,a)},openAddTopicWindow:function(){return this.controller.openAddTopicWindow(),!1}}),Theodorus.namespace("topic").TopicView=Theodorus.View.extend({el:"#main",initialize:function(){_.bindAll(this,"setup")},render:function(a){var b=this,c=this.controller.topic,d=this.controller.io.user,e='<page type="topicView"><url>'+encodeURI(location.href)+"</url>"+d.xml()+(c?c.xml():"<topicLoading />")+"</page>";return console.log(location.href),console.log(decodeURI(location.href)),console.log(encodeURI(location.href)),console.log(e),this.transform(e,function(c){a&&a(b,c)}),this},setup:function(a){return $("#link_suggest_topic").click(this.openAddTopicWindow),Theodorus.View.prototype.setup.call(this,a)}});