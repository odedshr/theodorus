/*! theodorus 2014-09-22 */
Theodorus.Controller=Class.extend({init:function(a){_.bindAll(this,"render"),this.io=a,this.view&&this.view.setController(this)},render:function(a){var b=this;return this.view.render(function(){b.setup(),a&&a()}),this},setup:function(a){return this.view.setup(function(){a&&a()}),this}}),Theodorus.namespace("user").AccountController=Theodorus.Controller.extend({init:function(a){this.view=new Theodorus.user.AccountView,this._super(a),_.bindAll(this,"openAuthenticationWindow","onAuthenticationCompleted","signout")},openAuthenticationWindow:function(a){var b=a?new Theodorus.user.SigninController(this.io):new Theodorus.user.SignupController(this.io);b.callback=this.onAuthenticationCompleted,b.view.setAsPopUp(!0),b.render()},onAuthenticationCompleted:function(a){Theodorus.onAccountLoaded(a)},signout:function(){var a=this;return this.io.ajax({url:"/me",type:"DELETE",success:a.onAuthenticationCompleted})}}),Theodorus.namespace("feed").FeedController=Theodorus.Controller.extend({init:function(a){this.view=new Theodorus.feed.FeedView,this._super(a),_.bindAll(this,"openAddTopicWindow","refreshTopicList","reload"),this.account=new Theodorus.user.AccountController(a),this.topics=new Theodorus.feed.TopicListController(a),this.tags=new Theodorus.feed.TagCloudController(a)},setup:function(){},openAddTopicWindow:function(){this.addTopic=new Theodorus.feed.AddTopicController(this.io),this.addTopic.view.setAsPopUp(!0),this.addTopic.render()},refreshTopicList:function(){this.topics.load()},reload:function(){this.refreshTopicList()}}),Theodorus.namespace("topic").TopicController=Theodorus.Controller.extend({topic:null,init:function(a){this.view=new Theodorus.topic.TopicView,this._super(a),_.bindAll(this,"render","load")},render:function(a){var b=this;this.topic||this.load(function(a){b.topic=404==a.status?new Notification(a):new Topic(a),a&&b.render()}),this._super(a)},load:function(a){this.io.get("/"+this.io.docURL,a).fail(a)}});