app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t){var n=O.COOKIE("authToken");if(void 0!==n)return{credentials:n};if(i)return{};var s=new Error("unauthorized");return t(s),s}function t(i,t,n,s,e){s[i]=e,t&&n(s)}this.api=this.api||{backend:server,cache:{},cacheExpiration:18e4},this.api.saveToCache=function(i,t,n){this.api.cache[i]={modified:(new Date).getTime(),response:n},t(n)}.bind(this),this.api.get=function(t,n,s){var e=i(s,n);if(!(e instanceof Error)){this.log("api get "+t,this.logType.debug);var a=this.api.cache;a[t]&&a[t].modified>(new Date).getTime()-this.api.cacheExpiration?n(a[t].response):O.AJAX.get(this.api.backend+t,this.api.ifNotError.bind(this,this.api.saveToCache.bind(this,t,n)),e)}}.bind(this),this.api["delete"]=function(t,n,s){var e=i(s,n);e instanceof Error||(this.log("api delete "+t,this.logType.debug),this.api.clearCache(),O.AJAX["delete"](this.api.backend+t,this.api.ifNotError.bind(this,this.api.saveToCache.bind(this,key,n)),e))}.bind(this),this.api.post=function(t,n,s,e){var a=i(e,s);a instanceof Error||(this.log("api post "+t+"\n"+JSON.stringify(n),this.logType.debug),this.api.clearCache(),O.AJAX.post(this.api.backend+t,n,this.api.ifNotError.bind(this,s),a))}.bind(this),this.api.put=function(t,n,s,e){var a=i(e,s);a instanceof Error||(this.log("api put "+t+"\n"+JSON.stringify(n),this.logType.debug),this.api.clearCache(),O.AJAX.put(this.api.backend+t,n,this.api.ifNotError.bind(this,s),a))}.bind(this),this.api.clearCache=function(){this.api.cache={}}.bind(this),this.api.ifNotError=function(i,t){t instanceof Error&&t.message instanceof XMLHttpRequestProgressEvent&0===t.status?O.EVT.dispatch("connection-error",t.message):i(t)}.bind(this),this.api.async=function(i,n){for(var s=i.slice().reverse(),e={};s.length;){var a=s.pop(),o=a.name.split(" ").pop();a(t.bind(this,o,0===s.length,n,e))}}.bind(this),this.api.ping=function(i){this.api.get("ping",this.api.ifNotError.bind(this,i),!0)}.bind(this);var n=function(i,t,n,s){this.api.post(i,{email:t,password:n},s,!0)};return this.api.signIn=n.bind(this,"signin"),this.api.signUp=n.bind(this,"signup"),this.api.getEmail=function(i){this.api.get("email/",i)}.bind(this),this.api.updateProfileImage=function(i,t,n){this.api.post("".concat("membership/",i,"/image"),t,n)}.bind(this),this.api.getProfileImageURL=function(i){return"".concat(this.api.backend,"membership/",i,"/image")}.bind(this),this.api.addCommunity=function(i,t){this.api.post("community/",i,t)}.bind(this),this.api.getCommunityList=function(i){this.api.get("community/",i,!0)}.bind(this),this.api.getMyCommunities=function(i){this.api.get("membership/",i)}.bind(this),this.api.getCommunity=function(i,t){this.api.get("community/"+i+"/",t,!0)}.bind(this),this.api.getCommunityTopics=function(i,t){this.api.get("community/"+i+"/topics/",t,!0)}.bind(this),this.api.joinCommunity=function(i,t,n){this.api.post("community/"+i+"/members/",t,n)}.bind(this),this.api.quitCommunity=function(i,t){this.api.post("community/"+i+"/quit/",{},t)}.bind(this),this.api.archive=function(i,t,n){this.api["delete"](i+"/"+t,n)}.bind(this),this.api.getCommunityTopics=function(i,t){this.api.get("community/"+i+"/topics/",t,!0)}.bind(this),this.api.addTopic=function(i,t){this.api.post("topic/",i,t)}.bind(this),this.api.getTopicOpinions=function(i,t){this.api.get("topic/"+i+"/opinions/",t,!0)}.bind(this),this.api.setOpinion=function(i,t){i.id?this.api.post("opinion/"+i.id,i,t):i.topicId?this.api.post("topic/"+i.topicId+"/opinion/",i,t):t(new Error("missing-details"))}.bind(this),this.api.getPostComments=function(i,t,n){var s=void 0===t?"opinion":"comment";"opinion"===s&&(t=i),this.api.get(s+"/"+t+"/comments/",n,!0)}.bind(this),this.api.setComment=function(i,t){i.id?this.api.post("comment/"+i.id,i,t):this.api.post("comment/",i,t)}.bind(this),this.api.feedback=function(i,t){this.api.post("feedback/",i,t,!0)}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(){var t=location.href;return html2canvas(document.body,{onrendered:function(i){window.setTimeout(e.bind(this,i.toDataURL(),t),1)}}),!0}function e(t,e){O.ELM.url.value=e,O.ELM.image.value=t,O.ELM.screenshotSample.src=t,O.ELM.screenshotRow.removeAttribute("data-hidden")}function i(t){try{var e=this.getFormFields(t.detail.target);e.feedbackIncludesScreenshot||delete e.image,this.api.feedback(e,n.bind(this))}catch(i){this.log(i,"debug")}return t.detail.preventDefault(),!1}function n(){this.notify({notifySuccessFeedbackSent:{}})}return this.registry=this.registry||{},this.registry.reportBug={attributes:{onclick:t.bind(this)}},this.registry.frmSendFeedback={attributes:{onsubmit:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){t({founderName:i})}function i(t,i){for(var e="",m=0,n={},s=i.length;s--;){var o=i[s].membershipName,a=n[o];a=void 0===n[o]?1:a+1,n[o]=a,a>=m&&(e=o,m=a)}t(e)}function e(t,i){this.state.communityJSON=i.getCommunity,this.state.communityTopics=i.getCommunityTopics;var e={communityId:i.getCommunity.id,communityName:i.getCommunity.name,isMember:void 0!==i.getCommunity.membership&&"active"===i.getCommunity.membership.status,topics:i.getCommunityTopics};e.isMember&&(e.memberName=i.getCommunity.membership.name?i.getCommunity.membership.name:""),this.state.email&&(e.email=i.getEmail.email),t(e)}function m(t){var i={name:O.ELM.communityName.value};if(0===i.name.length)alert("name cannot be empty");else{var e=O.ELM.founderName.value;e.length>0&&(i.founderName=e),this.api.addCommunity(i,n.bind(this))}t.detail.preventDefault()}function n(t){t instanceof Error||!t?(alert("failed to add community"),console.log(t)):location.href="#community:"+t.id}return this.registry=this.registry||{},this.components=this.components||{},this.registry.frmAddCommunity={attributes:{onsubmit:m.bind(this)},preprocess:function(e,m){this.api.getMyCommunities(t.bind(this,i.bind(this,m)))}},this.registry.communityPage={preprocess:function(t,i){var m=this.state.community;void 0!==m&&m.length>0?this.api.async([this.api.getCommunity.bind(this,m),this.api.getCommunityTopics.bind(this,m)],e.bind(this,i)):this.updateURL("communities","")}.bind(this)},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){var e={isAuthenticated:this.isAuthenticated(),communityId:i.id,communityName:i.name,isMember:i.membership&&"active"===i.membership.status?!0:!1};t(e)}function i(t){var i=this.state.community,n={name:O.ELM.memberName.value};this.api.joinCommunity(i,n,e.bind(this,i)),t.detail.preventDefault()}function e(t,i){i instanceof Error?409===i.status?this.updateURL("community:"+t+"/",O.TPL.translate("pageTitle.community")):(this.log(i,this.logType.debug),alert("failed to join community")):this.updateURL("community:"+t+"/",O.TPL.translate("pageTitle.community"))}return this.registry=this.registry||{},this.components=this.components||{},this.registry.communityJoinPage={preprocess:function(i,e){var n=this.state.community;this.api.getCommunity(n,t.bind(this,e))}.bind(this)},this.registry.frmJoinCommunity={attributes:{onsubmit:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){t({communities:{community:i}})}function i(t){this.confirm(O.TPL.translate("confirm.leaveCommunity"),n.bind(this)),t.detail.preventDefault()}function n(t){t&&this.api.quitCommunity(this.state.community,s.bind(this))}function s(){this.updateURL("community/",O.TPL.translate("pageTitle.community"))}return this.registry=this.registry||{},this.components=this.components||{},this.registry.communityList={preprocess:function(i,n){this.api.getCommunityList(t.bind(this,n))}.bind(this)},this.registry.btnLeave={attributes:{onclick:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function e(e,t){if(void 0===t.getCommunity.membership||"active"!==t.getCommunity.membership.status)return void this.updateURL("community:"+t.getCommunity.id+"/",O.TPL.translate("pageTitle.community"));this.state.communityJSON=t.getCommunity,console.log(this.api.getProfileImageURL(this.state.communityJSON.membership.id));var i={communityId:t.getCommunity.id,communityName:t.getCommunity.name,profileImage:this.api.getProfileImageURL(this.state.communityJSON.membership.id)};i.isMember&&(i.memberName=t.getCommunity.membership.name?t.getCommunity.membership.name:""),i.email=t.getEmail.email,e(i)}function t(e){var t=e.detail.target.files[0],m=new FileReader;m.onload=i.bind(this),m.readAsDataURL(t),e.detail.preventDefault()}function i(e){try{O.ELM.profileImagePreview.src=this.resizeImage(e.target.result,128,128)}catch(t){this.log(t)}}function m(e){var t=O.ELM.profileImagePreview.src;console.log(this.state.communityJSON.membership.id),this.api.updateProfileImage(this.state.communityJSON.membership.id,{image:t},n),e.detail.preventDefault()}function n(e){console.log("image uploaded")}return this.registry=this.registry||{},this.components=this.components||{},this.registry.communitySettingsPage=function(t,i){var m=this.state.community;void 0!==m&&m.length>0?this.api.getCommunity(m,e.bind(this,i)):this.updateURL("communities","")}.bind(this),this.registry.uploadProfileImageForm=function(e,i){O.ELM.imageProfileChooser.onchange=t.bind(this),O.ELM.btnUpdateProfileImage.onclick=m.bind(this),i()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){for(var i=t.length,e={};i--;)e[t[i]]=!0;return e}function i(i){--i.progress||(this.templates=t(O.TPL.list()),O.ELM.refresh(),this.register(O.ELM.appContainer))}return this.registry=this.registry||{},this.state=this.state||{},this.templates=this.templates||{},this.onConnectionError=function(){void 0===O.ELM.connectionError&&this.notify({notifyErrorConnection:{}})}.bind(this),this.registry.appContainer={preprocess:function(t,i){i({showUserDetailsInHeader:this.isAuthenticated(),pageTemplate:this.getPageTemplateName()})}.bind(this)},this.init=function(){var t={progress:3};O.EVT.subscribe("window.onload",i.bind(this,t)).subscribe("TPL.templatesLoaded",i.bind(this,t)).subscribe("TPL.languageLoaded",i.bind(this,t)).subscribe("connection-error",this.onConnectionError),O.TPL.load("templates.html"),O.TPL.setLocale("en-us"),O.TPL.loadLanguage("i18n/en-us.json")}.bind(this),this.init(),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(){history.back()}function i(){return this.log("not yet implemented",this.logType.error),!1}function e(t){var i=t.detail.target.closest("[data-id][data-type]"),e=i.getAttribute("data-type"),n=i.getAttribute("data-id"),s=i.parentNode;this.api.archive(e,n,this.simplyReturn),this.updateCount(s.closest("[data-id][data-type]"),i.getAttribute("data-type"),-1),"oion"!==e?O.DOM.remove(s):O.ELM.opinionContent.value=""}function n(t,i){void 0!==O.ELM.connectionError&&O.DOM.remove(O.ELM.connectionError),this.state.username=i.username,t&&t()}return this.registry=this.registry||{},this.state=this.state||{},this.registry.appContainer={preprocess:function(t,i){this.renderPage(),i()}.bind(this)},this.registry.btnCancel={attributes:{onclick:t}},this.registry.notFoundPage={preprocess:function(t,i){this.setAppTitle("page not found"),i({isAuthenticated:this.isAuthenticated()})}.bind(this)},this.registry.frmPageNotFound={attributes:{onsubmit:i}},this.registry.pageNotFoundURL={attributes:{value:window.location.hash}},this.isAuthenticated=function(){var t=O.COOKIE("authToken");return t.length>0}.bind(this),this.onPageChanged=function(t){var i=t.newURL;this.renderPage(i.substr(i.indexOf("#")),"")}.bind(this),window.onhashchange=this.onPageChanged,this.updateURL=function(t){history.pushState({},t,location.href.split("#")[0]+"#"+t),this.renderPage()}.bind(this),this.getPageTitleFromHash=function(t){if(!t.length)return"";for(var i=t[0].key,e=1;e<t.length;e++){var n=t[e].key;i+=" "+n.substr(0,1).toUpperCase()+n.substr(1)}return i}.bind(this),this.setAppTitle=function(t){var i=document.title.split(":")[0];document.title=i+(t.length>0?": "+t.substr(0,1).toUpperCase()+t.substr(1):"")}.bind(this),this.getPageTemplateName=function(){var t=this.extractArgumentsFromLocationHash(),i=this.getPageTitleFromHash(t),e=(i.length?i.replace(/\s/g,""):this.isAuthenticated()?"home":"welcome")+"Page";return O.ELM.appContainer.setAttribute("data-section",t.length>0?t[0].key:"home"),-1===O.TPL.list().indexOf(e)&&(e="notFoundPage"),e}.bind(this),this.renderPage=function(){var t=this.getPageTemplateName();this.state=this.extend(this.state,this.getMappedArguments()),O.ELM.pageContainer.setAttribute("data-register",t),this.register(O.ELM.pageContainer)}.bind(this),this.registry.archive={attributes:function(t,i){t.onclick=e.bind(this),i()}.bind(this)},this.updateCount=function(t,i,e){if(t){var n=t.querySelector('[data-role="'+i+'-count"]');n&&(n.innerHTML=+n.innerHTML+e)}}.bind(this),this.ping=function(t){this.api.ping(n.bind(this,t))}.bind(this),this.registry.ping={preprocess:function(t,i){t.onclick=O.EVT.subscribe("ping",this.api.ping.bind(this,n)).getDispatcher("ping"),i()}.bind(this)},this.onCloseNotificationClicked=function(t){return O.DOM.remove(t.target.closest(".notification")),!1}.bind(this),this.registry.closeNotification=function(t,i){t.onclick=this.onCloseNotificationClicked,i()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return!0}function e(t){return!0}function i(t){return void 0===t||e(t)}var n='((([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))';this.models=this.models||{};var a=this.models;return a.user={status:{"enum":{active:"active",suspended:"suspended",archived:"archived"},validate:function(t){return!0}},created:{},modified:{},lastLogin:{},email:{validate:function(t){return t.match(n)?!0:void 0}},password:{validate:function(t){return t&&t.length>0}},birthDate:{},isFemale:{}},a.community={},a.membership={},a.topic={content:{validate:function(t,e){return!0}}},a.opinion={id:{validate:i},topicId:{validate:e},content:{validate:function(t,e){return!0}}},a.comment={id:{validate:i},opinionId:{validate:e},parentId:{validate:i},content:{validate:function(t,e){return!0}}},a.feedback={id:{validate:i},image:{validate:t},content:{validate:function(t){return t>0}}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t){for(var e=this.state.communityJSON.membership?this.state.communityJSON.membership.id:!1,o=t.length;o--;){var s=t[o];s.time=moment(s.modified).format("MMM Do YY, h:mma"),s.relativeTime=moment(s.modified).fromNow(),s.isArchivable=e===s.author.id&&0===s.opinions&&0===s.endorse,s.author.image=this.api.getProfileImageURL(s.author.id)}i({topics:{topic:t}})}function t(i){var t=i.target.closest(".topic"),e=t.querySelector(".opinions");O.CSS.has(t,"hide-opinions")?(O.CSS.remove(t,"hide-opinions"),e.setAttribute("data-register","opinionList"),this.register(e)):(O.CSS.add(t,"hide-opinions"),e.removeAttribute("data-register"))}function e(i){var t=O.ELM.topicContent.value;if(this.models.topic.content.validate(t,this.state.communityJSON)){var e={communityId:this.state.community,content:t,status:"published"};this.api.addTopic(e,o.bind(this))}i.detail.preventDefault()}function o(){loadTopicList.call(this,O.ELM.communityTopics)}return this.registry=this.registry||{},this.registry.opinionList={preprocess:function(t,e){var o=this.state.community;this.api.getCommunityTopics(o,i.bind(this,e))}.bind(this)},this.registry.frmAddTopic={attributes:{onsubmit:e.bind(this)}},this.registry.tglOpinion={attributes:{onclick:t.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var n=O.ELM.signInEmail.value,e=O.ELM.signInPassword.value;this.api.signIn(n,e,t.bind(this,!0)),i.detail.preventDefault()}function t(i,t){t instanceof Error?alert("failed to sign in"):(O.COOKIE("authToken",t,i?30:1),this.api.clearCache(),this.goToStateRedirect())}return this.registry=this.registry||{},this.registry.frmSignIn={attributes:{onsubmit:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){O.COOKIE("authToken",""),this.state.email="",this.api.clearCache(),this.goToStateRedirect(),t.detail.preventDefault()}return this.registry=this.registry||{},this.registry.btnSignOut={attributes:{onclick:t.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var e=O.ELM.signUpEmail.value,s=O.ELM.signUpPassword.value,a=O.ELM.signUpRetypePassword.value,r=this.models.user;r.email.validate(e)?r.password.validate(s)?s===a?this.api.signUp(e,s,t.bind(this)):this.log("retype password",this.logType.error):this.log("illegal password",this.logType.error):this.log("illegal email",this.logType.error),i.detail.preventDefault()}function t(i){i instanceof Error?alert("failed to sign up"):(O.COOKIE("authToken",i,1),this.api.clearCache(),this.goToStateRedirect())}return this.registry=this.registry||{},this.registry.frmSignUp={attributes:{onsubmit:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t){for(var e=this.state.communityJSON.membership?this.state.communityJSON.membership.id:!1,o=t.length;o--;){var s=t[o];s.time=moment(s.modified).format("MMM Do YY, h:mma"),s.relativeTime=moment(s.modified).fromNow(),s.isArchivable=e===s.author.id&&0===s.opinions&&0===s.endorse,s.author.image=this.api.getProfileImageURL(s.author.id)}i({topics:{topic:t}})}function t(i){var t=i.target.closest(".topic"),e=t.querySelector(".opinions");O.CSS.has(t,"hide-opinions")?(O.CSS.remove(t,"hide-opinions"),e.setAttribute("data-register","opinionList"),this.register(e)):(O.CSS.add(t,"hide-opinions"),e.removeAttribute("data-register"))}function e(i){var t=O.ELM.topicContent.value;if(this.models.topic.content.validate(t,this.state.communityJSON)){var e={communityId:this.state.community,content:t,status:"published"};this.api.addTopic(e,o.bind(this))}i.detail.preventDefault()}function o(){loadTopicList.call(this,O.ELM.communityTopics)}return this.registry=this.registry||{},this.registry.topicList={preprocess:function(t,e){var o=this.state.community;this.api.getCommunityTopics(o,i.bind(this,e))}.bind(this)},this.registry.frmAddTopic={attributes:{onsubmit:e.bind(this)}},this.registry.tglOpinion={attributes:{onclick:t.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function e(e,t,i){if(void 0===t){if(void 0===i)return;throw this.log("no template for "+t,this.logType.debug),new Error("template-not-found")}try{if(this.templates[t]){var r={};r[t]=i,e.innerHTML=O.TPL.render(r),O.ELM.refresh()}else this.log("no template for "+t,this.logType.debug);this.registerChildren(e.querySelectorAll("[data-register]:not(.js-registered)"))}catch(n){this.log(n,this.logType.debug)}}this.registry=this.templates||{},this.templates=this.templates||{},this.ifNotError=function(e,t){t instanceof Error?alert(t):e(t)}.bind(this),this.simplyReturn=function(e){return e}.bind(this),this.isProduction=function(){var e=location.href;return-1===e.indexOf("localhost")&&-1===e.indexOf("127.0.0.1")}(),this.logType={debug:"debug",system:"system",community:"community",message:"message",score:"score",error:"error"},this.log=function(e,t,i){return void 0===t&&(t=this.logType.system),t===this.logType.debug&&this.isProduction||(void 0===i?console.log(t+": "+e):console.log(t+": "+e,i)),e}.bind(this),this.notify=function(e){var t=O.ELM.notifications;O.DOM.append(t,O.TPL.render(e)),O.ELM.refresh(),this.register(t.childNodes[t.childNodes.length-1])}.bind(this),this.confirm=function(e,t){t(window.confirm(e))}.bind(this),this.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}.bind(this),this.goToStateRedirect=function(){location.href=location.href.split("#")[0]+(this.state.redirect?this.state.redirect:"")}.bind(this),this.getPathFromURL=function(){return location.href.replace(new RegExp("(https?:\\/\\/)|("+location.host+"\\/)","g"),"").split("#")[0].split("?")[0]}.bind(this),this.extractArgumentsFromLocationHash=function(){for(var e,t=/\+/g,i=/([^\/:]+):?([^\/]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.hash.substring(1),o=[];e=i.exec(n);){var s={key:r(e[1]),value:r(e[2])};o.push(s)}return o}.bind(this);var t=function(){for(var e,t=/\+/g,i=/([^&=]+)=?([^&]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.search.substring(1),o={};e=i.exec(n);)o[r(e[1])]=r(e[2]);return o},i=function(e,t){return decodeURIComponent(t.replace(e," "))},r=function(){for(var e,t=/\+/g,r=/([^\/:]+):?([^\/]*)/g,n=i.bind(this,t),o=window.location.hash.substring(1),s={};e=r.exec(o);)s[n(e[1])]=n(e[2]);return s};return this.getMappedArguments=function(){return this.extend(t(),r())}.bind(this),this.getFormFields=function(e){var t=e.elements,i={};for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];n.name&&(i[n.name]="checkbox"==n.type?n.checked:n.value)}return i}.bind(this),this.resizeImage=function(e,t,i){var r=new Image;r.src=e;var n=1,o=document.createElement("canvas");o.style.display="none",document.body.appendChild(o);var s=o.getContext("2d");s.drawImage(r,0,0);var h=document.createElement("canvas");h.style.display="none",document.body.appendChild(h);var d=o.getContext("2d"),a=h.getContext("2d");r.width>t?n=t/r.width:r.height>i&&(n=i/img.height),h.width=r.width,h.height=r.height,a.drawImage(r,0,0);var c=r.width*n,g=r.height*n;o.width=t,o.height=i,d.drawImage(h,(t-c)/2,(i-g)/2,c,g);var l=o.toDataURL("image/png");return document.body.removeChild(o),document.body.removeChild(h),l}.bind(this),this.registerChildren=function(e){for(var t=e.length;t--;){var i=e[t];"none"!==i.style.display&&this.register(i)}}.bind(this),this.register=function(t){var i=t.getAttribute("data-register");void 0===i&&(i=t.getAttribute("id")),O.CSS.remove(t,"register").add(t,"registering");var r=this.registry[i];if(void 0!==r&&void 0!==r.attributes){var n=r.attributes;for(var o in n)t[o]=n[o]}if(void 0===r){if(void 0===this.templates[i])throw new Error("cannot register template "+i);e.call(this,t,i,{})}else void 0!==r.preprocess&&r.preprocess.call(this,t,e.bind(this,t,i));O.CSS.remove(t,"registering").add(t,"registered")}.bind(this),this.onWindowResize=function(){this.registerChildren(O.ELM.per(".js-register"))}.bind(this),window.onresize=O.EVT.subscribe("window.resize",this.onWindowResize).getDispatcher("window.resize"),this}.call(app);