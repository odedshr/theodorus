app="undefined"!=typeof app?app:{},function(){"use strict";return this.api=this.api||{backend:location.href.indexOf("localhost")>-1?"http://localhost:5000/":"http://theo-dorus.rhcloud.com/",cache:{},cacheExpiration:18e4},this.api.saveToCache=function(i,t,h){this.api.cache[i]={modified:(new Date).getTime(),response:h},t(h)}.bind(this),this.api.cached=function(i,t,h,s){var n=this.api.cache,a=i+t;return n[a]&&n[a].modified>(new Date).getTime()-this.api.cacheExpiration?n[a].response:void("post"===i||"put"===i?O.AJAX[i](this.api.backend+t,h,this.ifNotError.bind(this,this.api.saveToCache.bind(this,a,s))):(s=h,console.log("===>"+t),O.AJAX[i](this.api.backend+t,this.ifNotError.bind(this,this.api.saveToCache.bind(this,a,s)))))}.bind(this),this.api.clearCache=function(){this.api.cache={}}.bind(this),this.addCommunity=function(i,t){this.api.cached("post","community/",i,t)}.bind(this),this.api.getCommunityList=function(i){this.api.cached("get","community/",i)}.bind(this),this.api.getMyCommunities=function(i){this.api.cached("get","membership/",i)}.bind(this),this.api.getCommunity=function(i,t){this.api.cached("get","community/"+i+"/",t)}.bind(this),this.api.getCommunityTopics=function(i,t){this.api.cached("get","community/"+i+"/topics/",t)}.bind(this),this.api.joinCommunity=function(i,t,h){this.api.cached("post","community/"+i+"/members/",t,h)}.bind(this),this.api.quitCommunity=function(i,t){this.api.cached("post","community/"+i+"/quit/",t)}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){var i=t.detail.target.closest('[data-type="opinion"]'),n=t.detail.target.closest("[data-id]"),o=i===n?void 0:n.getAttribute("data-id"),d=i.getAttribute("data-id"),a=i.querySelector('[data-role="comments"]');"true"===a.getAttribute("data-hidden")?(O.ELM.per('[data-role="comments"]:not([data-hidden="true"])').each(function(t){t.setAttribute("data-hidden","true"),t.innerHTML=""}),e.call(this,a,d,o),a.removeAttribute("data-hidden")):a.setAttribute("data-hidden","true")}function e(t,e,n){this.api.getPostComments(e,n,i.bind(this,t,e,n))}function i(t,e,i,n){for(var o=n.length,d=this.state.communityJSON.membership,a=d?d.id:!1;o--;){var m=n[o];m.time=moment(m.modified).format("MMM Do YY, h:mma"),m.relativeTime=moment(m.modified).fromNow(),m.isArchivable=a===m.author.id&&0===m.comments&&0===m.endorse}var s={commentList:{commentId:"",opinionId:e,parentId:i?i:"",comments:{comment:n}}};this.render(t,s),this.register(t)}function n(t){var e=O.ELM.commentContent.value,i=O.ELM.opinionId.value,n=O.ELM.parentId.value,d=O.ELM.commentId.value;if(0===n.length&&(n=void 0),this.models.comment.id.validate(d))if(this.models.comment.opinionId.validate(i))if(this.models.comment.parentId.validate(n))if(this.models.comment.content.validate(e,this.state.communityJSON)){var a={communityId:this.state.community,id:d,opinionId:i,parentId:n,content:e,status:"published"};this.api.setComment(a,o.bind(this,t.detail.target.closest("[data-type][data-id]"),i,n))}else this.log("content = "+e);else this.log("parentId = "+n);else this.log("opinionId = "+topicId);else this.log("commentId = "+topicId);return!1}function o(t,i,n){this.updateCount(t,"comment",1),e.call(this,t.querySelector('[data-role="comments"]'),i,n)}return this.registry=this.registry||{},O.EVT.subscribe("toggle-comment",t.bind(this)),O.EVT.subscribe("submit-add-comment",n.bind(this)),this.registry.tglComment=function(t,e){t.onclick=O.EVT.getDispatcher("toggle-comment"),e()}.bind(this),this.registry.frmAddComment=function(t,e){t.onsubmit=O.EVT.getDispatcher("submit-add-comment"),e()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){for(var t="",n=0,m={},e=i.length;e--;){var s=i[e].membershipName,o=m[s];o=void 0===m[s]?1:o+1,m[s]=o,o>=n&&(t=s,n=o)}O.ELM.founderName.value=t}function t(i,t){var n={communityId:t.id,communityName:t.name,isMember:!1};console.log(t),t.membership&&(n.isMember="active"===t.membership.status,n.memberName=t.membership.name?t.membership.name:""),this.render(O.ELM.pageContainer,{communityPage:n}),i()}function n(i,t){var n={communityId:t.id,communityName:t.name,isMember:t.membership&&"active"===t.membership.status?!0:!1};this.render(O.ELM.pageContainer,{communityJoinPage:n}),i()}function m(){var i=this.state.community,t={name:O.ELM.memberName.value};return this.api.joinCommunity(i,t,e.bind(this,i)),!1}function e(i,t){t instanceof Error?alert("failed to join community"):this.updateURL("community:"+i+"/",O.TPL.translate("pageTitle.community"))}function s(i){var t={name:O.ELM.communityName.value};if(0===t.name.length)alert("name cannot be empty");else{var n=O.ELM.founderName.value;n.length>0&&(t.founderName=n),this.api.addCommunity(t,o.bind(this))}return!1}function o(i){i instanceof Error?(alert("failed to add community"),console.log(i)):location.href="#community:"+i.id}function u(i,t){this.render(i,{communityList:{communities:{community:t}}})}return this.registry=this.registry||{},this.registry.frmAddCommunity=function(t,n){t.onsubmit=O.EVT.subscribe("submit-add-community",s.bind(this)).getDispatcher("submit-add-community"),this.api.getMyCommunities(i.bind(this)),n()}.bind(this),this.registry.communityPage=function(i,n){var m=this.state.community;this.api.getCommunity(m,t.bind(this,n))}.bind(this),this.registry.communityJoinPage=function(i,t){var m=this.map.community;this.api.getCommunity(m,n.bind(this,t))}.bind(this),this.registry.frmJoinCommunity=function(i,t){i.onsubmit=O.EVT.subscribe("submit-join-community",m.bind(this)).getDispatcher("submit-join-community"),t()}.bind(this),this.registry.frmAddCommunity=function(i,t){i.onsubmit=O.EVT.subscribe("submit-add-community",m.bind(this)).getDispatcher("submit-add-community"),t()}.bind(this),this.registry.btnLeave=function(i,t){i.onclick=O.EVT.subscribe("submit-quit-community",this.onLeaveClicked.bind(this)).getDispatcher("submit-quit-community"),t()}.bind(this),this.onLeaveClicked=function a(){var i=this.state.community;this.api.quitCommunity(i,a.bind(this,i))}.bind(this),this.onLeftCommunity=function(i){this.updateURL("community:"+i+"/",O.TPL.translate("pageTitle.community"))}.bind(this),this.registry.myCommunityList=function(i,t){this.api.getMyCommunities(u.bind(this,i)),t()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";var t=0;this.registry=this.registry||{},this.state=this.state||{},this.registry.appContainer=function(t,e){this.renderPage()}.bind(this),this.onCancelButtonClicked=function(){history.back()}.bind(this),this.registry.btnCancel=function(t,e){t.onclick=this.onCancelButtonClicked}.bind(this),this.isAuthenticated=function(){var t=O.COOKIE("authToken");return t.length>0}.bind(this),this.onPageChanged=function(t){var e=t.detail.newURL;this.renderPage(e.substr(e.indexOf("#")),"")}.bind(this),this.updateURL=function(t,e){history.pushState({},e,location.href.split("#")[0]+"#"+t),this.renderPage()}.bind(this),this.getPageTitleFromHashTag=function(){var t=this.extractArgumentsFromLocationHash();if(!t.length)return"";for(var e=t[0].key,n=1;n<t.length;n++){var i=t[n].key;e+=" "+i.substr(0,1).toUpperCase()+i.substr(1)}return e}.bind(this),this.setAppTitle=function(t){var e=document.title.split(":")[0];document.title=e+(t.length>0?": "+t.substr(0,1).toUpperCase()+t.substr(1):"")}.bind(this),this.renderPage=function(){var t={},e=this.getPageTitleFromHashTag(),n=(e.length?e.replace(/\s/g,""):this.isAuthenticated()?"home":"welcome")+"Page";t[n]={},this.state=this.mapArgumentsFromLocationHash(),this.setAppTitle(e),console.log("renderPage "+n),this.render(O.ELM.pageContainer,t),this.register(n)}.bind(this);var e=function(){var t=O.COOKIE("authToken"),e=t.length>0;e&&O.AJAX.setDefaults({credentials:t}),this.render(O.ELM.appContainer,{application:{showUserDetailsInHeader:e}}),this.register(O.ELM.appContainer)}.bind(this);return this.onComponentLoaded=function(){--t||(O.ELM.refresh(),e())}.bind(this),this.init=function(){t=3,window.onhashchange=O.EVT.subscribe("window.onhashchange",this.onPageChanged).getDispatcher("window.onhashchange"),O.EVT.subscribe("window.onload",this.onComponentLoaded).subscribe("TPL.templatesLoaded",this.onComponentLoaded).subscribe("TPL.languageLoaded",this.onComponentLoaded),O.TPL.load("templates.html"),O.TPL.setLocale("en-us"),O.TPL.loadLanguage("i18n/en-us.json")}.bind(this),this.init(),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(){return this.log("not yet implemented",this.logType.error),!1}function e(t){var e=t.detail.target.closest("[data-id][data-type]"),i=e.getAttribute("data-type"),n=e.getAttribute("data-id"),s=e.parentNode;this.api.archive(i,n,this.simplyReturn),this.updateCount(s.closest("[data-id][data-type]"),e.getAttribute("data-type"),-1),"opinion"!==i?O.DOM.remove(s):O.ELM.opinionContent.value=""}return this.registry=this.registry||{},this.state=this.state||{},this.registry.appContainer=function(t,e){this.renderPage()}.bind(this),this.onCancelButtonClicked=function(){history.back()}.bind(this),this.registry.btnCancel=function(t,e){t.onclick=this.onCancelButtonClicked}.bind(this),this.registry.notFoundPage=function(e,i){O.ELM.frmPageNotFound.onsubmit=O.EVT.subscribe("submit-page-not-found",t.bind(this)).getDispatcher("submit-page-not-found"),O.ELM.pageNotFoundURL.value=window.location.hash}.bind(this),this.isAuthenticated=function(){var t=O.COOKIE("authToken");return t.length>0}.bind(this),this.onPageChanged=function(t){var e=t.detail.newURL;this.renderPage(e.substr(e.indexOf("#")),"")}.bind(this),this.updateURL=function(t,e){history.pushState({},e,location.href.split("#")[0]+"#"+t),this.renderPage()}.bind(this),this.getPageTitleFromHash=function(t){if(!t.length)return"";for(var e=t[0].key,i=1;i<t.length;i++){var n=t[i].key;e+=" "+n.substr(0,1).toUpperCase()+n.substr(1)}return e}.bind(this),this.setAppTitle=function(t){var e=document.title.split(":")[0];document.title=e+(t.length>0?": "+t.substr(0,1).toUpperCase()+t.substr(1):"")}.bind(this),this.renderPage=function(){console.log(location.href);var t={},e=this.extractArgumentsFromLocationHash(),i=this.getPageTitleFromHash(e),n=(i.length?i.replace(/\s/g,""):this.isAuthenticated()?"home":"welcome")+"Page";O.ELM.appContainer.setAttribute("data-section",e.length>0?e[0].key:"home"),-1===O.TPL.list().indexOf(n)&&(n="notFoundPage"),t[n]={},this.state=this.getMappedArguments(),this.setAppTitle(i),this.log("renderPage "+n,this.logType.debug),this.render(O.ELM.pageContainer,t),this.register(n)}.bind(this),O.EVT.subscribe("archive",e.bind(this)),this.registry.archive=function(t,e){t.onclick=O.EVT.getDispatcher("archive"),e()}.bind(this),this.updateCount=function(t,e,i){if(t){var n=t.querySelector('[data-role="'+e+'-count"]');n&&(n.innerHTML=+n.innerHTML+i)}}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t){var n={communityId:t.id,communityName:t.name,isMember:t.membership&&"active"===t.membership.status?!0:!1,isAuthenticated:this.isAuthenticated()};n.isMember?(this.log("already member in this community, moving to community page",this.logType.debug),this.updateURL("community:"+n.communityId+"/",O.TPL.translate("pageTitle.community"))):this.render(O.ELM.pageContainer,{communityJoinPage:n}),i()}function t(){var i=this.state.community,t={name:O.ELM.memberName.value};return this.api.joinCommunity(i,t,n.bind(this,i)),!1}function n(i,t){if(t instanceof Error)alert("failed to join community");else{var n={communityId:this.state.community,content:O.TPL.translate("post.xJoinedCommunity").replace("{name}",t.name),status:"active"};this.api.clearCache(),this.api.addTopic(n,this.updateURL.bind(this,"community:"+i+"/",O.TPL.translate("pageTitle.community")))}}return this.registry=this.registry||{},this.registry.communityJoinPage=function(t,n){var e=this.state.community;void 0!==e&&e.length>0?this.api.getCommunity(e,i.bind(this,n)):this.render(O.ELM.pageContainer,{errorPage:{errorMessage:O.TPL.translate("error.cannotJoinCommunityWithoutId")}})}.bind(this),this.registry.frmJoinCommunity=function(i,t){i.onsubmit=this.simplyReturn.bind(this,!1),t()}.bind(this),this.registry.btnJoinSubmit=function(i,n){i.onclick=O.EVT.subscribe("submit-join-community",t.bind(this)).getDispatcher("submit-join-community"),n()}.bind(this),this.registry.btnLeave=function(i,t){i.onclick=O.EVT.subscribe("submit-quit-community",this.onLeaveClicked.bind(this)).getDispatcher("submit-quit-community"),t()}.bind(this),this.onLeaveClicked=function(){var i=this.state.community;this.api.clearCache(),this.api.quitCommunity(i,this.updateURL.bind(this,"community:"+i+"/",O.TPL.translate("pageTitle.community")))}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return!0}function e(e){return void 0===e||t(e)}var i='((([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))';this.models=this.models||{};var n=this.models;return n.user={status:{"enum":{active:"active",suspended:"suspended",archived:"archived"},validate:function(t){return!0}},created:{},modified:{},lastLogin:{},email:{validate:function(t){return t.match(i)?!0:void 0}},password:{validate:function(t){return t&&t.length>0}},birthDate:{},isFemale:{}},n.community={},n.membership={},n.topic={content:{validate:function(t,e){return!0}}},n.opinion={id:{validate:e},topicId:{validate:t},content:{validate:function(t,e){return!0}}},n.comment={id:{validate:e},opinionId:{validate:t},parentId:{validate:e},content:{validate:function(t,e){return!0}}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var n=i.detail.target.closest('[data-type="topic"]'),e=n.getAttribute("data-id"),o=n.querySelector('[data-role="opinions"]');"true"===o.getAttribute("data-hidden")?(O.ELM.per('[data-role="opinions"]:not([data-hidden="true"])').each(function(i){i.setAttribute("data-hidden","true"),i.innerHTML=""}),t.call(this,e),o.removeAttribute("data-hidden")):o.setAttribute("data-hidden","true")}function t(i){this.api.getTopicOpinions(i,n.bind(this,i))}function n(i,t){var n=t.length,e=this.state.communityJSON.membership,o=e?e.id:!1,s=!1,a=0;for(O.ELM["topic_"+i+"_opinion_count"].innerHTML=n;n--;){var r=t[n];r.time=moment(r.modified).format("MMM Do YY, h:mma"),r.relativeTime=moment(r.modified).fromNow(),r.mine=o===r.authorId,r.isArchivable=r.mine&&0===r.comments&&0===r.endorse,r.mine&&(a=n,s=r,r.topicId=i)}var d={opinions:{opinion:t}};s?(t.splice(a,1),t.unshift(s)):e&&(d.hasMyOpinion=s,d.opinionMeta={topicId:i,content:"",author:{name:e.name}});var p=O.ELM["topic_"+i+"_opinion_list"];this.render(p,{opinionList:d}),this.register(p)}function e(){var i=O.ELM.opinionContent.value,t=O.ELM.opinionTopicId.value;if(this.models.opinion.topicId.validate(t))if(this.models.opinion.content.validate(i,this.state.communityJSON)){var n={communityId:this.state.community,topicId:t,content:i,status:"published"};this.api.setOpinion(n,o.bind(this,t))}else this.log("content = "+i);else this.log("topicId = "+t);return!1}function o(i){t.call(this,i)}return this.registry=this.registry||{},O.EVT.subscribe("toggle-opinion",i.bind(this)),this.registry.tglOpinion=function(i,t){i.onclick=O.EVT.getDispatcher("toggle-opinion"),t()}.bind(this),this.registry.frmAddOpinion=function(i,t){i.onsubmit=O.EVT.subscribe("submit-add-opinion",e.bind(this)).getDispatcher("submit-add-opinion"),t()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var s=O.ELM.signInEmail.value,t=O.ELM.signInPassword.value,e={email:s,password:t};return O.AJAX.post(this.backend+"signin",e,n.bind(this,!0)),!1}function n(i,n){n instanceof Error?alert("failed to sign in"):(O.COOKIE("authToken",n,i?30:1),this.api.clearCache(),this.updateURL("",""))}return this.registry=this.registry||{},this.registry.frmSignIn=function(n,s){n.onsubmit=O.EVT.subscribe("submit-sign-in",i.bind(this)).getDispatcher("submit-sign-in"),s()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return O.COOKIE("authToken",""),this.api.clearCache(),location.href="/",!1}return this.registry=this.registry||{},this.registry.btnSignOut=function(i,n){i.onclick=O.EVT.subscribe("sign-out",t.bind(this)).getDispatcher("sign-out"),n()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i){var t=O.ELM.signUpEmail.value,n=O.ELM.signUpPassword.value,e=(O.ELM.signUpRetypePassword.value,{email:t,password:n});return O.AJAX.post(this.backend+"signup",e,s.bind(this)),!1}function s(i){i instanceof Error?alert("failed to sign up"):(O.COOKIE("authToken",i,1),this.api.clearCache(),this.updateURL("",""))}return this.registry=this.registry||{},this.registry.frmSignUp=function(s,t){s.onsubmit=O.EVT.subscribe("submit-sign-up",i.bind(this)).getDispatcher("submit-sign-up"),t()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t){this.render(i,{topicList:{topics:{topic:t}}})}return this.registry=this.registry||{},this.registry.communityTopicList=function(t,s){var n=this.state.community;this.api.getCommunityTopics(n,i.bind(this,t)),s()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";return this.ifNotError=function(e,t){t instanceof Error?alert(t):e(t)}.bind(this),this.extractArgumentsFromLocationHash=function(){for(var e,t=/\+/g,i=/([^\/:]+):?([^\/]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.hash.substring(1),s=[];e=i.exec(n);){var o={key:r(e[1]),value:r(e[2])};s.push(o)}return s}.bind(this),this.mapArgumentsFromLocationHash=function(){for(var e,t=/\+/g,i=/([^\/:]+):?([^\/]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.hash.substring(1),s={};e=i.exec(n);)s[r(e[1])]=r(e[2]);return s}.bind(this),this.render=function(e,t){try{e.innerHTML=O.TPL.render(t),O.ELM.refresh()}catch(i){console.log(i),console.log(O.TPL.list())}}.bind(this),this.onElementRegistered=function(e){void 0!==e&&e.length&&this.registerS(O.ELM.per("#"+e+" [data-register]:not(.js-registered)"))}.bind(this),this.registerS=function(e){for(var t=e.length;t--;){var i=e[t];"none"!==i.style.display&&this.register(i)}}.bind(this),this.register=function(e){var t,i;if(e){"string"==typeof e?(i=e,e=O.ELM.pageContainer):i=e.getAttribute("data-register"),t=e.id,0===t.length&&(e.setAttribute("id",i?i:"elm"+parseInt(1e4*Math.random())),t=e.id),(void 0===i||null===i||0===i.length)&&(i=t),O.CSS.remove(e,"register").add(e,"registering");var r=this.registry[i];console.log("register %c"+(r?"✓ ":"✗ ")+i,r?"color: green":"color: red"),r?r(e,this.onElementRegistered.bind(this,t)):this.onElementRegistered(t),O.CSS.remove(e,"registering").add(e,"registered")}}.bind(this),this.onWindowResize=function(){this.registerS(O.ELM.per(".js-register"))}.bind(this),window.onresize=O.EVT.subscribe("window.resize",this.onWindowResize).getDispatcher("window.resize"),this}.call(app);