app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t){var n=O.COOKIE("authToken");if(void 0!==n)return{credentials:n};if(i)return{};var s=new Error("unauthorized");return t(s),s}function t(i,t,n,s,e){s[i]=e,t&&n(s)}function n(i,t){this.api.get("topic/"+i+"/opinions/",t,!0)}function s(i,t){i.id?this.api.post("opinion/"+i.id,{opinion:i},t):i.topicId?this.api.post("topic/"+i.topicId+"/opinion/",i,t):t(new Error("missing-details"))}this.api=this.api||{backend:server,cache:{},cacheExpiration:18e4},this.api.saveToCache=function(i,t,n){this.api.cache[i]={modified:(new Date).getTime(),response:n},t(n)}.bind(this),this.api.get=function(t,n,s){var e=i(s,n);if(!(e instanceof Error)){this.log("api get "+t,this.logType.debug);var o=this.api.cache;o[t]&&o[t].modified>(new Date).getTime()-this.api.cacheExpiration?n(o[t].response):O.AJAX.get(this.api.backend+t,this.api.ifNotError.bind(this,this.api.saveToCache.bind(this,t,n)),e)}}.bind(this),this.api["delete"]=function(t,n,s){var e=i(s,n);e instanceof Error||(this.log("api delete "+t,this.logType.debug),this.api.clearCache(),O.AJAX["delete"](this.api.backend+t,this.api.ifNotError.bind(this,n),e))}.bind(this),this.api.post=function(t,n,s,e){var o=i(e,s);o instanceof Error||(this.log("api post "+t+"\n"+JSON.stringify(n),this.logType.debug),this.api.clearCache(),O.AJAX.post(this.api.backend+t,n,this.api.ifNotError.bind(this,s),o))}.bind(this),this.api.put=function(t,n,s,e){var o=i(e,s);o instanceof Error||(this.log("api put "+t+"\n"+JSON.stringify(n),this.logType.debug),this.api.clearCache(),O.AJAX.put(this.api.backend+t,n,this.api.ifNotError.bind(this,s),o))}.bind(this),this.api.clearCache=function(){this.api.cache={}}.bind(this),this.api.ifNotError=function(i,t){t instanceof Error&&t.message instanceof XMLHttpRequestProgressEvent&0===t.status?O.EVT.dispatch("connection-error",t.message):i(t)}.bind(this),this.api.async=function(i,n){for(var s=i.slice().reverse(),e={};s.length;){var o=s.pop(),a=o.name.split(" ").pop();o(t.bind(this,a,0===s.length,n,e))}}.bind(this),this.api.ping=function(i){this.api.get("ping",this.api.ifNotError.bind(this,i),!0)}.bind(this);var e=function(i,t,n,s){this.api.post(i,{email:t,password:n},s,!0)};return this.api.signIn=e.bind(this,"signin"),this.api.signUp=e.bind(this,"signup"),this.api.getEmail=function(i){this.api.get("email/",i)}.bind(this),this.api.updateProfileImage=function(i,t,n){this.api.post("".concat("membership/",i,"/image"),t,n)}.bind(this),this.api.getProfileImageURL=function(i){return"".concat(this.api.backend,"membership/",i,"/image")}.bind(this),this.api.addCommunity=function(i,t){this.api.post("community/",i,t)}.bind(this),this.api.getCommunityList=function(i){this.api.get("community/",i,!0)}.bind(this),this.api.getMyCommunities=function(i){this.api.get("membership/",i)}.bind(this),this.api.getCommunity=function(i,t){this.api.get("community/"+i+"/",t,!0)}.bind(this),this.api.getCommunityTopics=function(i,t){this.api.get("community/"+i+"/topics/",t,!0)}.bind(this),this.api.joinCommunity=function(i,t,n){this.api.post("community/"+i+"/members/",t,n)}.bind(this),this.api.quitCommunity=function(i,t){this.api.post("community/"+i+"/quit/",{},t)}.bind(this),this.api.archive=function(i,t,n){this.api["delete"](i+"/"+t,n)}.bind(this),this.api.getCommunityTopics=function(i,t){this.api.get("community/"+i+"/topics/",t,!0)}.bind(this),this.api.addTopic=function(i,t){this.api.post("topic/",i,t)}.bind(this),this.api.getTopicOpinions=n.bind(this),this.api.setOpinion=s.bind(this),this.api.getPostComments=function(i,t,n){var s=null===t?"opinion":"comment";"opinion"===s&&(t=i),this.api.get(s+"/"+t+"/comments/",n,!0)}.bind(this),this.api.setComment=function(i,t){i.id?this.api.post("comment/"+i.id,{comment:i},t):this.api.post("comment/",i,t)}.bind(this),this.api.feedback=function(i,t){this.api.post("feedback/",i,t,!0)}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i,e,n){for(var o=this.state.communityJSON.membership?this.state.communityJSON.membership.id:!1,m=n.length;m--;){var s=n[m];s.author.image=this.api.getProfileImageURL(s.author.id),s.time=moment(s.modified).format("MMM Do YY, h:mma"),s.relativeTime=moment(s.modified).fromNow(),s.isEditable=o===s.author.id&&0===s.comments&&0===s.endorse,s.isEditable&&(s.opinionId=t?t:"",s.parentId=i?i:"")}e({id:"",opinionId:t?t:"",parentId:i?i:"",content:"",comments:{comment:n}})}function i(t){var i=this.getFormFields(t.target),n=0===i.opinionId.length?"comment":"opinion",o=i.parentId;switch(n){case"opinion":o=i.opinionId,delete i.parentId;break;case"comment":delete i.opinionId}return this.models.comment.content.validate(i.content,this.state.communityJSON)?this.api.setComment(i,e.bind(this,t.target,n,o,0===i.id.length)):this.log("bad comment",this.logType.error),!1}function e(t,i,e,n){if(n){var o=O.ELM[i+"-"+e];this.updateCount(o,"comment",1),this.removeArchiveButton(i,e)}this.register(O.ELM["".concat(i,"-",e,"-comments")])}return this.registry=this.registry||{},this.registry.commentList={preprocess:function(i,e){var n=i.getAttribute("data-opinion-id"),o=i.getAttribute("data-comment-id");this.api.getPostComments(n,o,t.bind(this,n,o,e))}.bind(this)},this.registry.frmSetComment={attributes:{onsubmit:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,e){this.api.getMyCommunities(t.bind(this,n.bind(this,e)))}function t(i,t){i({founderName:t})}function n(i,t){for(var n="",e=0,r={},o=t.length;o--;){var s=t[o].membershipName,a=r[s];a=void 0===r[s]?1:a+1,r[s]=a,a>=e&&(n=s,e=a)}i(n)}function e(i){var t=this.getFormFields(i.target);return this.api.addCommunity(t,r.bind(this)),!1}function r(i){i instanceof Error||!i?(alert("failed to add community"),console.log(i)):location.href="#community:"+i.id}return this.registry=this.registry||{},this.registry.frmAddCommunity={attributes:{onsubmit:e.bind(this)},preprocess:i.bind(this)},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){var e={isAuthenticated:this.isAuthenticated(),communityId:i.id,communityName:i.name,isMember:i.membership&&"active"===i.membership.status?!0:!1};t(e)}function i(t){var i=this.state.community,n={name:O.ELM.memberName.value};return this.api.joinCommunity(i,n,e.bind(this,i)),!1}function e(t,i){i instanceof Error?409===i.status?this.updateURL("community:"+t+"/",O.TPL.translate("pageTitle.community")):(this.log(i,this.logType.debug),alert("failed to join community")):this.updateURL("community:"+t+"/",O.TPL.translate("pageTitle.community"))}return this.registry=this.registry||{},this.registry.communityJoinPage={preprocess:function(i,e){var n=this.state.community;this.api.getCommunity(n,t.bind(this,e))}.bind(this)},this.registry.frmJoinCommunity={attributes:{onsubmit:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){t({communities:{community:i}})}return this.registry=this.registry||{},this.registry.communitiesPage={preprocess:function(t,i){i({isAuthenticated:this.isAuthenticated()})}.bind(this)},this.registry.communityList={preprocess:function(i,s){document.title=O.TPL.translate("title.communities"),this.api.getCommunityList(t.bind(this,s))}.bind(this)},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){document.title=i.getCommunity.name,this.state.communityJSON=i.getCommunity,this.state.communityTopics=i.getCommunityTopics;var m={communityId:i.getCommunity.id,communityName:i.getCommunity.name,isMember:void 0!==i.getCommunity.membership&&"active"===i.getCommunity.membership.status,topics:i.getCommunityTopics};m.isMember&&(m.memberName=i.getCommunity.membership.name?i.getCommunity.membership.name:""),m.email=this.state.email,t(m)}function i(t){return this.confirm(O.TPL.translate("confirm.leaveCommunity"),m.bind(this)),!1}function m(t){t&&this.api.quitCommunity(this.state.community,e.bind(this))}function e(){this.updateURL("community/",O.TPL.translate("pageTitle.community"))}return this.registry=this.registry||{},this.registry.communityPage={preprocess:function(i,m){var e=this.state.community;void 0!==e&&e.length>0?this.api.async([this.api.getCommunity.bind(this,e),this.api.getCommunityTopics.bind(this,e)],t.bind(this,m)):this.updateURL("communities","")}.bind(this)},this.registry.btnLeave={attributes:{onclick:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){document.title=O.TPL.translate("title.communitySettings");var s=this.state.community;void 0!==s&&s.length>0?this.api.getCommunity(s,e.bind(this,i)):this.updateURL("communities","")}function e(t,e){if(this.state.communityJSON=e,void 0===e.membership||"active"!==e.membership.status)return void this.updateURL("community:"+e.id+"/",O.TPL.translate("pageTitle.community"));document.title="".concat(e.name," ",O.TPL.translate("title.settings"));var i={communityId:e.id,communityName:e.name,profileImage:this.api.getProfileImageURL(e.membership.id)};i.isMember&&(i.memberName=e.membership.name?e.membership.name:""),i.email=this.state.email,t(i)}function i(t){var e=t.target.files[0],i=new FileReader;return i.onload=s.bind(this),i.readAsDataURL(e),!1}function s(t){try{O.ELM.profileImagePreview.src=this.resizeImage(t.target.result,128,128)}catch(e){this.log(e)}}function a(t){var e=O.ELM.profileImagePreview.src;return this.api.updateProfileImage(this.state.communityJSON.membership.id,{image:e},this.simplyReturn),!1}return this.registry=this.registry||{},this.components=this.components||{},this.registry.communitySettingsPage={preprocess:t.bind(this)},this.registry.imageProfileChooser={attributes:{onchange:i.bind(this)}},this.registry.btnUpdateProfileImage={attributes:{onclick:a.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){document.title=O.TPL.translate("title.feedback"),e()}function e(){var t=location.href;return html2canvas(document.body,{onrendered:function(e){window.setTimeout(i.bind(this,e.toDataURL(),t),1)}}),!0}function i(t,e){O.ELM.url.value=e,O.ELM.image.value=t,O.ELM.screenshotSample.src=t,O.ELM.screenshotRow.removeAttribute("data-hidden")}function n(t){try{var e=this.getFormFields(t.detail.target);e.feedbackIncludesScreenshot||delete e.image,this.api.feedback(e,r.bind(this))}catch(i){this.log(i,"debug")}return!1}function r(){this.notify({notifySuccessFeedbackSent:{}})}return this.registry=this.registry||{},this.registry.reportBug={attributes:{onclick:e.bind(this)}},this.registry.feedbackPage={preprocess:t},this.registry.frmSendFeedback={attributes:{onsubmit:n.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){for(var i=t.length,n={};i--;)n[t[i]]=!0;return n}function i(i){--i.progress||(this.templates=t(O.TPL.list()),O.ELM.refresh(),this.register(O.ELM.appContainer))}return this.registry=this.registry||{},this.state=this.state||{},this.templates=this.templates||{},this.onConnectionError=function(){void 0===O.ELM.connectionError&&this.notify({notifyErrorConnection:{}})}.bind(this),this.init=function(){var t={progress:3};O.EVT.subscribe("window.onload",i.bind(this,t)).subscribe("TPL.templatesLoaded",i.bind(this,t)).subscribe("TPL.languageLoaded",i.bind(this,t)).subscribe("connection-error",this.onConnectionError),O.TPL.load("templates.html"),O.TPL.setLocale("en-us"),O.TPL.loadLanguage("i18n/en-us.json")}.bind(this),this.init(),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){this.state.email=e.email,t()}function e(){history.back()}function i(){return this.log("not yet implemented",this.logType.error),!1}function n(t){var e=t.target,i=e.getAttribute("data-type"),n=e.getAttribute("data-id");this.api.archive(i,n,r.bind(this,i,n))}function r(t,e){var i;"topic"===t?i=O.ELM[t+"-"+e]:(i=O.ELM[t+"-"+e].parentNode.closest(".js-item[data-id][data-type]"),this.updateCount(i,t,-1)&&("opinion"!==t?O.DOM.remove(O.ELM[t+"-"+e]):(i.querySelector(".js-opinion-content").value="",i.querySelector(".attribute.time").innerHTML=""))),this.register(i.closest(".js-list"))}function s(t){var e=t.target,i=O.ELM[e.getAttribute("data-target")];if("true"===i.getAttribute("data-hidden")){O.CSS.add(e,"toggled"),i.removeAttribute("data-hidden");var n=i.getAttribute("data-on-toggle");n&&(i.setAttribute("data-register",n),this.register(i))}else O.CSS.remove(e,"toggled"),i.setAttribute("data-hidden","true"),i.removeAttribute("data-register")}function a(t,e){void 0!==O.ELM.connectionError&&O.DOM.remove(O.ELM.connectionError),this.state.username=e.username,t&&t()}return this.registry=this.registry||{},this.state=this.state||{},this.registry.appContainer={preprocess:function(e,i){this.state=this.extend(this.state,this.getMappedArguments());var n=this.isAuthenticated(),r=i.bind(i,{showUserDetailsInHeader:n,pageTemplate:this.getPageTemplateName()});n?this.api.getEmail(t.bind(this,r)):r()}.bind(this)},this.registry.btnCancel={attributes:{onclick:e}},this.registry.notFoundPage={preprocess:function(t,e){document.title=O.TPL.translate("title.pageNotFound"),e({isAuthenticated:this.isAuthenticated()})}.bind(this)},this.registry.frmPageNotFound={attributes:{onsubmit:i}},this.registry.pageNotFoundURL={attributes:{value:window.location.hash}},this.isAuthenticated=function(){var t=O.COOKIE("authToken");return t.length>0}.bind(this),this.updateURL=function(t){history.pushState({},t,location.href.split("#")[0]+"#"+t),this.renderPage()}.bind(this),this.getPageTitleFromHash=function(t){if(!t.length)return"";for(var e=t[0].key,i=1;i<t.length;i++){var n=t[i].key;e+=" "+n.substr(0,1).toUpperCase()+n.substr(1)}return e}.bind(this),this.getPageTemplateName=function(){var t=this.extractArgumentsFromLocationHash(),e=this.getPageTitleFromHash(t),i=(e.length?e.replace(/\s/g,""):this.isAuthenticated()?"home":"welcome")+"Page";return O.ELM.appContainer.setAttribute("data-section",t.length>0?t[0].key:"home"),-1===O.TPL.list().indexOf(i)&&(i="notFoundPage"),i}.bind(this),this.renderPage=function(){var t=this.getPageTemplateName();this.state=this.extend(this.state,this.getMappedArguments()),O.ELM.pageContainer.setAttribute("data-register",t),this.register(O.ELM.pageContainer)}.bind(this),window.onhashchange=this.renderPage.bind(this),this.registry.archive={attributes:{onclick:n.bind(this)}},this.removeArchiveButton=function(t,e){var i=document.querySelector("".concat('[data-register="archive"][data-type="',t,'"][data-id="',e,'"]'));i&&O.DOM.remove(i)},this.registry.toggle={attributes:{onclick:s.bind(this)}},this.updateCount=function(t,e,i){if(t){var n=t.querySelector('[data-role="'+e+'-count"]');if(n){var r=+n.innerHTML+i;return n.innerHTML=r,r}}return 0}.bind(this),this.ping=function(t){this.api.ping(a.bind(this,t))}.bind(this),this.registry.ping={preprocess:function(t,e){t.onclick=O.EVT.subscribe("ping",this.api.ping.bind(this,a)).getDispatcher("ping"),e()}.bind(this)},this.onCloseNotificationClicked=function(t){return O.DOM.remove(t.target.closest(".notification")),!1}.bind(this),this.registry.closeNotification=function(t,e){t.onclick=this.onCloseNotificationClicked,e()}.bind(this),this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){document.title=O.TPL.translate("title.settings"),e()}return this.registry=this.registry||{},this.registry.mePage={preprocess:t},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,e){document.title=O.TPL.translate("title.messages"),e()}return this.registry=this.registry||{},this.registry.messagesPage={preprocess:t},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return!0}function e(t){return!0}function i(t){return void 0===t||e(t)}var n='((([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,})))';this.models=this.models||{};var a=this.models;return a.user={status:{"enum":{active:"active",suspended:"suspended",archived:"archived"},validate:function(t){return!0}},created:{},modified:{},lastLogin:{},email:{validate:function(t){return t.match(n)?!0:void 0}},password:{validate:function(t){return t&&t.length>0}},birthDate:{},isFemale:{}},a.community={},a.membership={},a.topic={content:{validate:function(t,e){return!0}}},a.opinion={id:{validate:i},topicId:{validate:e},content:{validate:function(t,e){return!0}}},a.comment={id:{validate:i},opinionId:{validate:e},parentId:{validate:i},content:{validate:function(t,e){return!0}}},a.feedback={id:{validate:i},image:{validate:t},content:{validate:function(t){return t>0}}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function i(i,t,e){for(var n,o=this.api.getProfileImageURL,s=this.state.communityJSON,r=s.membership?s.membership.id:!1,a=e.length;a--;){var m=e[a];m.time=moment(m.modified).format("MMM Do YY, h:mma"),m.relativeTime=moment(m.modified).fromNow(),m.author.image=o(m.author.id),m.isMine=r===m.author.id,m.includeAttributes=!0,m.isMine&&(n=m,m.isArchivable=0===m.comments&&0===m.endorse,e.splice(a,1))}void 0===n&&(n={author:{name:s.membership.name,image:o(r)},content:"",id:"",isMine:!0,includeAttributes:!1,relativeTime:""}),n.topicId=i,e.unshift(n),t({opinions:{opinion:e}})}function t(i){var t=i.target,n=this.getFormFields(t);return this.api.setOpinion(n,e.bind(this,t,n.id.length>0)),!1}function e(i,t){var e=i.closest('[data-id][data-type="topic"]'),n=e.getAttributes("data-id");t&&(this.updateCount(e,"opinion",1),this.removeArchiveButton("topic",n)),this.register(O.ELM["#".concat("topic-",n,"-comments")])}return this.registry=this.registry||{},this.registry.opinionList={preprocess:function(t,e){var n=t.getAttribute("data-topic-id");this.api.getTopicOpinions(n,i.bind(this,n,e))}.bind(this)},this.registry.frmSetOpinion={attributes:{onsubmit:t.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){var e=this.getFormFields(t.target);return this.api.signIn(e.email,e.password,i.bind(this,!0)),!1}function i(t,i){i instanceof Error?alert("failed to sign in"):(O.COOKIE("authToken",i,t?30:1),this.api.clearCache(),this.goToStateRedirect())}return this.registry=this.registry||{},this.registry.frmSignIn={attributes:{onsubmit:t.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){return O.COOKIE("authToken",""),this.state.email="",this.api.clearCache(),this.goToStateRedirect(),!1}return this.registry=this.registry||{},this.registry.btnSignOut={attributes:{onclick:t.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t){var e=this.getFormFields(t.target),s=e.email,r=e.password,a=this.models.user;return a.email.validate(s)?a.password.validate(r)?r===e.retypePassword?this.api.signUp(s,r,i.bind(this)):this.log("retype password",this.logType.error):this.log("illegal password",this.logType.error):this.log("illegal email",this.logType.error),!1}function i(t){t instanceof Error?alert("failed to sign up"):(O.COOKIE("authToken",t,1),this.api.clearCache(),this.goToStateRedirect())}return this.registry=this.registry||{},this.registry.frmSignUp={attributes:{onsubmit:t.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function t(t,i){for(var e=this.state.communityJSON.membership?this.state.communityJSON.membership.id:!1,s=i.length;s--;){var o=i[s];o.time=moment(o.modified).format("MMM Do YY, h:mma"),o.relativeTime=moment(o.modified).fromNow(),o.isArchivable=e===o.author.id&&0===o.opinions&&0===o.endorse,o.author.image=this.api.getProfileImageURL(o.author.id)}t({topics:{topic:i}})}function i(t){var i=O.ELM.topicContent.value;if(this.models.topic.content.validate(i,this.state.communityJSON)){var s={communityId:this.state.community,content:i,status:"published"};this.api.addTopic(s,e.bind(this))}return!1}function e(){this.register(O.ELM.communityTopics)}return this.registry=this.registry||{},this.registry.topicList={preprocess:function(i,e){var s=this.state.community;this.api.getCommunityTopics(s,t.bind(this,e))}.bind(this)},this.registry.frmAddTopic={attributes:{onsubmit:i.bind(this)}},this}.call(app);
app="undefined"!=typeof app?app:{},function(){"use strict";function e(e,t,i){if(void 0===t){if(void 0===i)return;throw this.log("no template for "+t,this.logType.debug),new Error("template-not-found")}try{if(this.templates[t]){var r={};r[t]=i,e.innerHTML=O.TPL.render(r),O.ELM.refresh()}else this.log("no template for "+t,this.logType.debug);this.registerChildren(e.querySelectorAll("[data-register]:not(.js-registered)"))}catch(n){this.log(n,this.logType.debug)}}this.registry=this.templates||{},this.templates=this.templates||{},this.ifNotError=function(e,t){t instanceof Error?alert(t):e(t)}.bind(this),this.simplyReturn=function(e){return e}.bind(this),this.isProduction=function(){var e=location.href;return-1===e.indexOf("localhost")&&-1===e.indexOf("127.0.0.1")}(),this.logType={debug:"debug",system:"system",community:"community",message:"message",score:"score",error:"error"},this.log=function(e,t,i){return void 0===t&&(t=this.logType.system),t===this.logType.debug&&this.isProduction||(void 0===i?console.log(t+": "+e):console.log(t+": "+e,i)),e}.bind(this),this.notify=function(e){var t=O.ELM.notifications;void 0===t&&(t=O.ELM.appContainer),O.DOM.append(t,O.TPL.render(e)),O.ELM.refresh(),this.register(t.childNodes[t.childNodes.length-1])}.bind(this),this.confirm=function(e,t){t(window.confirm(e))}.bind(this),this.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}.bind(this),this.goToStateRedirect=function(){var e=this.state.redirect?this.state.redirect:"";history.pushState({},e,location.href.split("#")[0]+"#"+e),this.register(O.ELM.appContainer)}.bind(this),this.getPathFromURL=function(){return location.href.replace(new RegExp("(https?:\\/\\/)|("+location.host+"\\/)","g"),"").split("#")[0].split("?")[0]}.bind(this),this.extractArgumentsFromLocationHash=function(){for(var e,t=/\+/g,i=/([^\/:]+):?([^\/]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.hash.substring(1),o=[];e=i.exec(n);){var s={key:r(e[1]),value:r(e[2])};o.push(s)}return o}.bind(this);var t=function(){for(var e,t=/\+/g,i=/([^&=]+)=?([^&]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.search.substring(1),o={};e=i.exec(n);)o[r(e[1])]=r(e[2]);return o},i=function(e,t){return decodeURIComponent(t.replace(e," "))},r=function(){for(var e,t=/\+/g,r=/([^\/:]+):?([^\/]*)/g,n=i.bind(this,t),o=window.location.hash.substring(1),s={};e=r.exec(o);)s[n(e[1])]=n(e[2]);return s};return this.getMappedArguments=function(){return this.extend(t(),r())}.bind(this),this.getFormFields=function(e){var t=e.elements,i={};for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];n.name&&(i[n.name]="checkbox"==n.type?n.checked:n.value)}return i}.bind(this),this.resizeImage=function(e,t,i){var r=new Image;r.src=e;var n=1,o=document.createElement("canvas");o.style.display="none",document.body.appendChild(o);var s=o.getContext("2d");s.drawImage(r,0,0);var h=document.createElement("canvas");h.style.display="none",document.body.appendChild(h);var a=o.getContext("2d"),d=h.getContext("2d");r.width>t?n=t/r.width:r.height>i&&(n=i/img.height),h.width=r.width,h.height=r.height,d.drawImage(r,0,0);var c=r.width*n,g=r.height*n;o.width=t,o.height=i,a.drawImage(h,(t-c)/2,(i-g)/2,c,g);var l=o.toDataURL("image/png");return document.body.removeChild(o),document.body.removeChild(h),l}.bind(this),this.registerChildren=function(e){for(var t=e.length;t--;){var i=e[t];"none"!==i.style.display&&this.register(i)}}.bind(this),this.register=function(t){var i=t.getAttribute("data-register");void 0===i&&(i=t.getAttribute("id")),O.CSS.remove(t,"register").add(t,"registering");var r=this.registry[i];if(void 0!==r&&void 0!==r.attributes){var n=r.attributes;for(var o in n)t[o]=n[o]}if(void 0===r){if(void 0===this.templates[i])throw new Error("cannot register template "+i);e.call(this,t,i,{})}else void 0!==r.preprocess&&r.preprocess.call(this,t,e.bind(this,t,i));O.CSS.remove(t,"registering").add(t,"registered")}.bind(this),this.onWindowResize=function(){this.registerChildren(O.ELM.per(".js-register"))}.bind(this),window.onresize=O.EVT.subscribe("window.resize",this.onWindowResize).getDispatcher("window.resize"),this}.call(app);